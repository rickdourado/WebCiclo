<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duplicar Curso - Ciclo Carioca</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Chamar toggleUnidades na carga da p√°gina para configurar campos required corretamente
            setTimeout(function() {
                console.log('üîß Chamando toggleUnidades na carga da p√°gina...');
                toggleUnidades();
                
                // Verificar se ainda h√° campos required ocultos
                const hiddenRequiredFields = document.querySelectorAll('input[required]:not([style*="display: none"]), select[required]:not([style*="display: none"])');
                const actuallyHiddenRequired = [];
                
                hiddenRequiredFields.forEach(field => {
                    const rect = field.getBoundingClientRect();
                    const isHidden = rect.width === 0 && rect.height === 0;
                    if (isHidden) {
                        actuallyHiddenRequired.push(field);
                    }
                });
                
                if (actuallyHiddenRequired.length > 0) {
                    console.warn('‚ö†Ô∏è Campos required ainda ocultos encontrados:', actuallyHiddenRequired.map(f => f.name));
                    actuallyHiddenRequired.forEach(field => {
                        field.removeAttribute('required');
                        console.log('üîß Removido required de campo oculto:', field.name);
                    });
                }
                
                console.log('‚úÖ toggleUnidades conclu√≠do na carga da p√°gina');
            }, 500);
            
            // Fun√ß√£o para formatar datas no formato brasileiro
            function formatarDataBrasileira() {
                const camposData = document.querySelectorAll('input[type="date"]');
                camposData.forEach(campo => {
                    campo.addEventListener('change', function() {
                        if (this.value) {
                            const [ano, mes, dia] = this.value.split('-');
                            const dataFormatada = `${dia}/${mes}/${ano}`;
                            // Exibe a data formatada em um elemento adjacente ou tooltip
                            this.setAttribute('title', `Data: ${dataFormatada}`);
                        }
                    });
                    // Formatar datas j√° preenchidas
                    if (campo.value) {
                        const [ano, mes, dia] = campo.value.split('-');
                        const dataFormatada = `${dia}/${mes}/${ano}`;
                        campo.setAttribute('title', `Data: ${dataFormatada}`);
                    }
                });
            }
            
            // Mostrar/ocultar campo de pr√©-requisitos com base na sele√ß√£o de certificado
            const certificadoSelect = document.getElementById('oferece_certificado');
            const preRequisitosGroup = document.getElementById('pre_requisitos_group');
            
            if (certificadoSelect && preRequisitosGroup) {
                function togglePreRequisitos() {
                    if (certificadoSelect.value === 'sim') {
                        preRequisitosGroup.style.display = 'block';
                    } else {
                        preRequisitosGroup.style.display = 'none';
                    }
                }
                
                certificadoSelect.addEventListener('change', togglePreRequisitos);
                togglePreRequisitos(); // Executar na carga inicial
            }
            
            // Gerenciar campos de hor√°rio online baseado no tipo de aula
            const tipoAulasOnline = document.querySelectorAll('input[name="aulas_assincronas"]');
            tipoAulasOnline.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        console.log('üìª Tipo de aula alterado para:', this.value);
                        toggleAulasAssincronas(this.value === 'sim');
                    }
                });
            });
            
            // Adicionar listener para mudan√ßas na modalidade
            const modalidadeSelect = document.getElementById('modalidade');
            if (modalidadeSelect) {
                modalidadeSelect.addEventListener('change', function() {
                    console.log('üîÑ Modalidade alterada para:', this.value);
                    
                    // Primeiro, remover required de TODOS os campos de hor√°rio
                    const todosHorarios = document.querySelectorAll('select[name="horario_inicio[]"], select[name="horario_fim[]"]');
                    todosHorarios.forEach(campo => {
                        campo.removeAttribute('required');
                        console.log('üßπ Limpando required de:', campo.name || campo.id);
                    });
                    
                    // Limpar valores dos campos da modalidade anterior
                    if (this.value === 'Online') {
                        // Limpar campos presenciais
                        const camposPresenciais = document.querySelectorAll('#unidades_container input, #unidades_container select');
                        camposPresenciais.forEach(campo => {
                            if (campo.type === 'checkbox') {
                                campo.checked = false;
                                console.log('üßπ Desmarcando checkbox presencial:', campo.name);
                            } else if (campo.type !== 'radio') {
                                campo.value = '';
                                console.log('üßπ Limpando campo presencial:', campo.name);
                            }
                        });
                    } else if (this.value === 'Presencial' || this.value === 'H√≠brido') {
                        // Limpar campos online (exceto vagas que pode ser reutilizada)
                        const camposOnline = document.querySelectorAll('#plataforma_container input, #plataforma_container select');
                        camposOnline.forEach(campo => {
                            // N√£o limpar o campo de vagas online pois pode ser reutilizado
                            if (campo.id === 'total_vagas_online') {
                                console.log('üîÑ Mantendo valor de vagas online para reutiliza√ß√£o');
                                return;
                            }
                            
                            if (campo.type === 'checkbox') {
                                campo.checked = false;
                                console.log('üßπ Desmarcando checkbox online:', campo.name);
                            } else if (campo.type === 'radio') {
                                campo.checked = false;
                                console.log('üßπ Desmarcando radio online:', campo.name);
                            } else {
                                campo.value = '';
                                console.log('üßπ Limpando campo online:', campo.name);
                            }
                        });
                    }
                    
                    // Depois chamar toggleUnidades
                    toggleUnidades();
                });
            }
            
            // Executar na carga inicial se j√° houver sele√ß√£o
            const tipoSelecionado = document.querySelector('input[name="aulas_assincronas"]:checked');
            if (tipoSelecionado) {
                toggleAulasAssincronas(tipoSelecionado.value === 'sim');
            }
            
            // Interceptar submit do formul√°rio para limpar campos required ocultos
            const form = document.querySelector('.course-form');
            if (form) {
                form.addEventListener('submit', function(e) {
                    console.log('üîç Verificando campos required ocultos antes do submit...');
                    
                    // Encontrar todos os campos required
                    const requiredFields = form.querySelectorAll('[required]');
                    const hiddenRequiredFields = [];
                    
                    requiredFields.forEach(field => {
                        // Verificar se o campo est√° realmente vis√≠vel
                        const rect = field.getBoundingClientRect();
                        const isHidden = rect.width === 0 && rect.height === 0;
                        const parentHidden = field.closest('[style*="display: none"], [style*="display:none"]');
                        const computedStyle = window.getComputedStyle(field);
                        const isDisplayNone = computedStyle.display === 'none';
                        const isVisibilityHidden = computedStyle.visibility === 'hidden';
                        
                        if (isHidden || parentHidden || isDisplayNone || isVisibilityHidden) {
                            hiddenRequiredFields.push(field);
                            field.removeAttribute('required');
                            console.log('üö´ Removido required de campo oculto no submit:', field.name || field.id, 'Motivo:', {
                                isHidden,
                                parentHidden: !!parentHidden,
                                isDisplayNone,
                                isVisibilityHidden
                            });
                        }
                    });
                    
                    if (hiddenRequiredFields.length > 0) {
                        console.log('‚úÖ Removidos', hiddenRequiredFields.length, 'campos required ocultos');
                    } else {
                        console.log('‚úÖ Nenhum campo required oculto encontrado');
                    }
                });
            }
            
            formatarDataBrasileira();
        });
    </script>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-container">
            <div class="loading-spinner">
                <div class="spinner-ring"></div>
            </div>
            <div class="loading-text">Criando Curso...</div>
            <div class="loading-description">
                Aguarde enquanto processamos as informa√ß√µes do curso
            </div>
            <div class="loading-progress">
                <div class="loading-progress-bar" id="loadingProgressBar"></div>
            </div>
            <div class="loading-steps">
                <div class="loading-step" id="step1">
                    <div class="step-icon">1</div>
                    <span>Validando informa√ß√µes</span>
                </div>
                <div class="loading-step" id="step2">
                    <div class="step-icon">2</div>
                    <span>Processando imagens</span>
                </div>
                <div class="loading-step" id="step3">
                    <div class="step-icon">3</div>
                    <span>Melhorando descri√ß√£o com IA</span>
                </div>
                <div class="loading-step" id="step4">
                    <div class="step-icon">4</div>
                    <span>Criando arquivos CSV e PDF</span>
                </div>
                <div class="loading-step" id="step5">
                    <div class="step-icon">5</div>
                    <span>Finalizando cria√ß√£o</span>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo-section">
                    <a href="{{ url_for('index') }}" title="Ir para p√°gina inicial">
                        <img src="{{ url_for('static', filename='images/logo_ciclocarioca..png') }}" alt="Logo Ciclo Carioca">
                    </a>
                    <span class="version">v2.0</span>
                </div>
                <div class="nav-section">
                    <a href="{{ url_for('index') }}" class="nav-link home-link" title="P√°gina Inicial">
                        <i class="fas fa-home"></i>
                    </a>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="form-container">
                <div class="form-header">
                    <h2><i class="fas fa-copy"></i> Duplicar Curso</h2>
                    <p class="form-description">Formul√°rio pr√©-preenchido com dados do curso selecionado. Edite as informa√ß√µes necess√°rias.</p>
                    {% if duplicate_data and duplicate_data.titulo_original %}
                    <div class="duplicate-notice">
                        <i class="fas fa-info-circle"></i>
                        <strong>Duplicando:</strong> {{ duplicate_data.titulo_original }}
                    </div>
                    {% endif %}
                </div>

                <!-- Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }}">
                                <i class="fas fa-{{ 'check-circle' if category == 'success' else 'exclamation-triangle' }}"></i>
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <form method="POST" action="{{ url_for('duplicate_course', course_id=original_course_id) }}" class="course-form" enctype="multipart/form-data">
                    <!-- Formul√°rio de Duplica√ß√£o de Curso -->
                    <div class="form-section">
                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label for="titulo" class="required">Nome do Curso</label>
                                <input type="text" id="titulo" name="titulo" required 
                                       placeholder="Digite o t√≠tulo do curso" value="{{ duplicate_data.titulo if duplicate_data else '' }}">
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="descricao" class="required">Descri√ß√£o</label>
                                <textarea id="descricao" name="descricao" rows="6" required
                                          placeholder="Digite a descri√ß√£o do curso">{{ duplicate_data.descricao if duplicate_data else '' }}</textarea>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="capa_curso">Capa do Curso</label>
                                <div class="file-upload-container">
                                    <input type="file" id="capa_curso" name="capa_curso" accept=".jpeg,.png,.jpg,.bmp,image/jpeg,image/png,image/jpg,image/bmp">
                                    <div class="file-upload-display">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <span class="file-upload-text">Clique para selecionar uma imagem</span>
                                        <div class="image-instructions">
                                            <div class="instruction-list">
                                                <p><strong>Instru√ß√µes para envio de imagem:</strong></p>
                                                <ul>
                                                    <li>Dimens√£o obrigat√≥ria: 1080 x 1080 px.</li>
                                                    <li>N√£o utilizar grafismos, textos ou logotipos. Utilizar poucos elementos visuais e de f√°cil leitura.</li>
                                                    <li>Escolha imagens que sejam representativas do curso ao qual se referem.</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="inicio_inscricoes" class="required">In√≠cio das inscri√ß√µes</label>
                                <div class="datetime-group">
                                    <input type="date" id="inicio_inscricoes_data" name="inicio_inscricoes_data" value="{{ duplicate_data.inicio_inscricoes_data if duplicate_data else '' }}" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="fim_inscricoes" class="required">Fim das inscri√ß√µes</label>
                                <div class="datetime-group">
                                    <input type="date" id="fim_inscricoes_data" name="fim_inscricoes_data" value="{{ duplicate_data.fim_inscricoes_data if duplicate_data else '' }}" required>
                                </div>
                            </div>
                            
                            <div class="form-group full-width">
                                 <label for="orgao" class="required">√ìrg√£o (Quem oferece o curso)</label>
                                <select id="orgao" name="orgao" required>
                                     <option value="">Selecione um √≥rg√£o</option>
                                    {% for orgao in orgaos %}
                                        <option value="{{ orgao }}" {% if duplicate_data and duplicate_data.orgao == orgao %}selected{% endif %}>{{ orgao }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                             
                             <div class="form-group full-width">
                                <label for="tema" class="required">Categoria</label>
                                 <select id="tema" name="tema" required>
                                     <option value="">Selecione a categoria</option>
                                     <option value="Tech" {% if duplicate_data and duplicate_data.tema == 'Tech' %}selected{% endif %}>Tech</option>
                                     <option value="Dados" {% if duplicate_data and duplicate_data.tema == 'Dados' %}selected{% endif %}>Dados</option>
                                     <option value="IA" {% if duplicate_data and duplicate_data.tema == 'IA' %}selected{% endif %}>IA</option>
                                     <option value="Design" {% if duplicate_data and duplicate_data.tema == 'Design' %}selected{% endif %}>Design</option>
                                     <option value="Ciberseguran√ßa" {% if duplicate_data and duplicate_data.tema == 'Ciberseguran√ßa' %}selected{% endif %}>Ciberseguran√ßa</option>
                                     <option value="Marketing" {% if duplicate_data and duplicate_data.tema == 'Marketing' %}selected{% endif %}>Marketing</option>
                                     <option value="Finan√ßas" {% if duplicate_data and duplicate_data.tema == 'Finan√ßas' %}selected{% endif %}>Finan√ßas</option>
                                     <option value="Gest√£o" {% if duplicate_data and duplicate_data.tema == 'Gest√£o' %}selected{% endif %}>Gest√£o</option>
                                     <option value="Games" {% if duplicate_data and duplicate_data.tema == 'Games' %}selected{% endif %}>Games</option>
                                     <option value="Nutri√ß√£o" {% if duplicate_data and duplicate_data.tema == 'Nutri√ß√£o' %}selected{% endif %}>Nutri√ß√£o</option>
                                     <option value="Educa√ß√£o" {% if duplicate_data and duplicate_data.tema == 'Educa√ß√£o' %}selected{% endif %}>Educa√ß√£o</option>
                                     <option value="Gastronomia" {% if duplicate_data and duplicate_data.tema == 'Gastronomia' %}selected{% endif %}>Gastronomia</option>
                                     <option value="Sa√∫de" {% if duplicate_data and duplicate_data.tema == 'Sa√∫de' %}selected{% endif %}>Sa√∫de</option>
                                     <option value="Veterin√°ria" {% if duplicate_data and duplicate_data.tema == 'Veterin√°ria' %}selected{% endif %}>Veterin√°ria</option>
                                     <option value="Carreira" {% if duplicate_data and duplicate_data.tema == 'Carreira' %}selected{% endif %}>Carreira</option>
                                     <option value="Est√©tica" {% if duplicate_data and duplicate_data.tema == 'Est√©tica' %}selected{% endif %}>Est√©tica</option>
                                     <option value="Sustentabilidade" {% if duplicate_data and duplicate_data.tema == 'Sustentabilidade' %}selected{% endif %}>Sustentabilidade</option>
                                     <option value="Artes" {% if duplicate_data and duplicate_data.tema == 'Artes' %}selected{% endif %}>Artes</option>
                                     <option value="Cultura" {% if duplicate_data and duplicate_data.tema == 'Cultura' %}selected{% endif %}>Cultura</option>
                                     <option value="Astronomia" {% if duplicate_data and duplicate_data.tema == 'Astronomia' %}selected{% endif %}>Astronomia</option>
                                 </select>
                            </div>

                            <div class="form-group full-width">
                                <label for="carga_horaria" class="required">Carga Hor√°ria</label>
                                <input type="text" id="carga_horaria" name="carga_horaria" required
                                    placeholder="Digite a carga hor√°ria (ex: 40 horas, 80h, 2 meses, etc.)"
                                    value="{{ duplicate_data.carga_horaria if duplicate_data else '' }}">
                                <small style="color: red; font-size: 0.9em; margin-top: 5px; display: block;">(D√™ prefer√™ncia a carga hor√°ria no formato de horas)</small>
                            </div>
                            
                             <div class="form-group full-width">
                                <label for="modalidade" class="required">Modalidade</label>
                                <select id="modalidade" name="modalidade" required onchange="toggleUnidades()">
                                     <option value="">Selecione a modalidade</option>
                                    <option value="Presencial" {% if duplicate_data and duplicate_data.modalidade == 'Presencial' %}selected{% endif %}>Presencial</option>
                                    <option value="Online" {% if duplicate_data and duplicate_data.modalidade == 'Online' %}selected{% endif %}>Online</option>
                                    <option value="H√≠brido" {% if duplicate_data and duplicate_data.modalidade == 'H√≠brido' %}selected{% endif %}>H√≠brido</option>
                                </select>
                            </div>    
                        
                             <!-- Subformul√°rio para Presencial/H√≠brido -->
                             <div class="form-group full-width" id="unidades_container" style="display:{% if duplicate_data and (duplicate_data.modalidade == 'Presencial' or duplicate_data.modalidade == 'H√≠brido') %}block{% else %}none{% endif %};">
                                 <fieldset class="unidade-fieldset">
                                     <legend>Informa√ß√µes das Unidades <button type="button" class="remove-unidade-btn" onclick="removeUnidade(this)" style="display:none;">&times;</button></legend>
                                     
                                     <!-- Container para m√∫ltiplas unidades -->
                                     <div id="unidades_list">
                                         {% if duplicate_data and duplicate_data.enderecos_unidades %}
                                         <!-- Renderizar unidades existentes na duplica√ß√£o -->
                                         {% for i in range(duplicate_data.enderecos_unidades|length) %}
                                         <div class="unidade-item" data-unidade="{{ i }}">
                                             <div class="unidade-header">
                                                 <h4>Unidade {{ i + 1 }}</h4>
                                                 {% if i > 0 %}
                                                 <button type="button" class="btn-remove-unidade" onclick="removeUnidade({{ i }})">
                                                     <i class="fas fa-trash"></i> Remover Unidade
                                                 </button>
                                                 {% endif %}
                                             </div>
                                             <label>Endere√ßo da unidade*</label>
                                             <input type="text" name="endereco_unidade[]" required value="{{ duplicate_data.enderecos_unidades[i] if i < duplicate_data.enderecos_unidades|length else '' }}">
                                             <label>Bairro*</label>
                                             <input type="text" name="bairro_unidade[]" required value="{{ duplicate_data.bairros_unidades[i] if i < duplicate_data.bairros_unidades|length else '' }}">
                                             <label>Total de vagas*</label>
                                             <input type="number" name="vagas_unidade[]" min="1" required value="{{ duplicate_data.vagas_unidades[i]|replace(',', '')|replace('.', '')|trim if i < duplicate_data.vagas_unidades|length else '' }}">

                                             <div class="data-group">
                                                 <div class="data-field">
                                                     <label>In√≠cio das aulas*</label>
                                                     <input type="date" name="inicio_aulas_data[]" required value="{{ duplicate_data.inicio_aulas_unidades[i] if duplicate_data and i < duplicate_data.inicio_aulas_unidades|length else '' }}">
                                                 </div>
                                                 <div class="data-field">
                                                     <label>Fim das aulas*</label>
                                                     <input type="date" name="fim_aulas_data[]" required value="{{ duplicate_data.fim_aulas_unidades[i] if duplicate_data and i < duplicate_data.fim_aulas_unidades|length else '' }}">
                                                 </div>
                                             </div>
                                             <div class="horario-group">
                                                 <div class="horario-field">
                                                     <label>Hor√°rio-In√≠cio*</label>
                                                     <select name="horario_inicio[]" required>
                                                         <option value="">Selecione o hor√°rio</option>
                                                         <option value="06:00" {% if duplicate_data and duplicate_data.horario_inicio_unidades[i] == '06:00' %}selected{% endif %}>06:00</option>
                                                         <option value="07:00" {% if duplicate_data and duplicate_data.horario_inicio_unidades[i] == '07:00' %}selected{% endif %}>07:00</option>
                                                         <option value="08:00" {% if duplicate_data and duplicate_data.horario_inicio_unidades[i] == '08:00' %}selected{% endif %}>08:00</option>
                                                         <option value="09:00" {% if duplicate_data and duplicate_data.horario_inicio_unidades[i] == '09:00' %}selected{% endif %}>09:00</option>
                                                         <option value="10:00" {% if duplicate_data and duplicate_data.horario_inicio_unidades[i] == '10:00' %}selected{% endif %}>10:00</option>
                                                         <option value="11:00" {% if duplicate_data and duplicate_data.horario_inicio_unidades[i] == '11:00' %}selected{% endif %}>11:00</option>
                                                         <option value="12:00" {% if duplicate_data and duplicate_data.horario_inicio_unidades[i] == '12:00' %}selected{% endif %}>12:00</option>
                                                         <option value="13:00" {% if duplicate_data and duplicate_data.horario_inicio_unidades[i] == '13:00' %}selected{% endif %}>13:00</option>
                                                         <option value="14:00" {% if duplicate_data and duplicate_data.horario_inicio_unidades[i] == '14:00' %}selected{% endif %}>14:00</option>
                                                         <option value="15:00" {% if duplicate_data and duplicate_data.horario_inicio_unidades[i] == '15:00' %}selected{% endif %}>15:00</option>
                                                         <option value="16:00" {% if duplicate_data and duplicate_data.horario_inicio_unidades[i] == '16:00' %}selected{% endif %}>16:00</option>
                                                         <option value="17:00" {% if duplicate_data and duplicate_data.horario_inicio_unidades[i] == '17:00' %}selected{% endif %}>17:00</option>
                                                         <option value="18:00" {% if duplicate_data and duplicate_data.horario_inicio_unidades[i] == '18:00' %}selected{% endif %}>18:00</option>
                                                         <option value="19:00" {% if duplicate_data and duplicate_data.horario_inicio_unidades[i] == '19:00' %}selected{% endif %}>19:00</option>
                                                         <option value="20:00" {% if duplicate_data and duplicate_data.horario_inicio_unidades[i] == '20:00' %}selected{% endif %}>20:00</option>
                                                         <option value="21:00" {% if duplicate_data and duplicate_data.horario_inicio_unidades[i] == '21:00' %}selected{% endif %}>21:00</option>
                                                         <option value="22:00" {% if duplicate_data and duplicate_data.horario_inicio_unidades[i] == '22:00' %}selected{% endif %}>22:00</option>
                                                         <option value="23:00" {% if duplicate_data and duplicate_data.horario_inicio_unidades[i] == '23:00' %}selected{% endif %}>23:00</option>
                                                     </select>
                                                 </div>
                                                 <div class="horario-field">
                                                     <label>Hor√°rio-Fim*</label>
                                                     <select name="horario_fim[]" required>
                                                         <option value="">Selecione o hor√°rio</option>
                                                         <option value="06:00" {% if duplicate_data and duplicate_data.horario_fim_unidades[i] == '06:00' %}selected{% endif %}>06:00</option>
                                                         <option value="07:00" {% if duplicate_data and duplicate_data.horario_fim_unidades[i] == '07:00' %}selected{% endif %}>07:00</option>
                                                         <option value="08:00" {% if duplicate_data and duplicate_data.horario_fim_unidades[i] == '08:00' %}selected{% endif %}>08:00</option>
                                                         <option value="09:00" {% if duplicate_data and duplicate_data.horario_fim_unidades[i] == '09:00' %}selected{% endif %}>09:00</option>
                                                         <option value="10:00" {% if duplicate_data and duplicate_data.horario_fim_unidades[i] == '10:00' %}selected{% endif %}>10:00</option>
                                                         <option value="11:00" {% if duplicate_data and duplicate_data.horario_fim_unidades[i] == '11:00' %}selected{% endif %}>11:00</option>
                                                         <option value="12:00" {% if duplicate_data and duplicate_data.horario_fim_unidades[i] == '12:00' %}selected{% endif %}>12:00</option>
                                                         <option value="13:00" {% if duplicate_data and duplicate_data.horario_fim_unidades[i] == '13:00' %}selected{% endif %}>13:00</option>
                                                         <option value="14:00" {% if duplicate_data and duplicate_data.horario_fim_unidades[i] == '14:00' %}selected{% endif %}>14:00</option>
                                                         <option value="15:00" {% if duplicate_data and duplicate_data.horario_fim_unidades[i] == '15:00' %}selected{% endif %}>15:00</option>
                                                         <option value="16:00" {% if duplicate_data and duplicate_data.horario_fim_unidades[i] == '16:00' %}selected{% endif %}>16:00</option>
                                                         <option value="17:00" {% if duplicate_data and duplicate_data.horario_fim_unidades[i] == '17:00' %}selected{% endif %}>17:00</option>
                                                         <option value="18:00" {% if duplicate_data and duplicate_data.horario_fim_unidades[i] == '18:00' %}selected{% endif %}>18:00</option>
                                                         <option value="19:00" {% if duplicate_data and duplicate_data.horario_fim_unidades[i] == '19:00' %}selected{% endif %}>19:00</option>
                                                         <option value="20:00" {% if duplicate_data and duplicate_data.horario_fim_unidades[i] == '20:00' %}selected{% endif %}>20:00</option>
                                                         <option value="21:00" {% if duplicate_data and duplicate_data.horario_fim_unidades[i] == '21:00' %}selected{% endif %}>21:00</option>
                                                         <option value="22:00" {% if duplicate_data and duplicate_data.horario_fim_unidades[i] == '22:00' %}selected{% endif %}>22:00</option>
                                                         <option value="23:00" {% if duplicate_data and duplicate_data.horario_fim_unidades[i] == '23:00' %}selected{% endif %}>23:00</option>
                                                     </select>
                                                 </div>
                                             </div>
                                             <label>Dias de aula*</label>
                                             <div class="checkbox-group dias-aula">
                                                 <label class="checkbox-label">
                                                     <input type="checkbox" name="dias_aula_presencial[]" value="Segunda-feira" {% if duplicate_data and duplicate_data.dias_aula_unidades[i] and 'Segunda-feira' in duplicate_data.dias_aula_unidades[i] %}checked{% endif %}>
                                                     <span>Segunda-feira</span>
                                                 </label>
                                                 <label class="checkbox-label">
                                                     <input type="checkbox" name="dias_aula_presencial[]" value="Ter√ßa-feira" {% if duplicate_data and duplicate_data.dias_aula_unidades[i] and 'Ter√ßa-feira' in duplicate_data.dias_aula_unidades[i] %}checked{% endif %}>
                                                     <span>Ter√ßa-feira</span>
                                                 </label>
                                                 <label class="checkbox-label">
                                                     <input type="checkbox" name="dias_aula_presencial[]" value="Quarta-feira" {% if duplicate_data and duplicate_data.dias_aula_unidades[i] and 'Quarta-feira' in duplicate_data.dias_aula_unidades[i] %}checked{% endif %}>
                                                     <span>Quarta-feira</span>
                                                 </label>
                                                 <label class="checkbox-label">
                                                     <input type="checkbox" name="dias_aula_presencial[]" value="Quinta-feira" {% if duplicate_data and duplicate_data.dias_aula_unidades[i] and 'Quinta-feira' in duplicate_data.dias_aula_unidades[i] %}checked{% endif %}>
                                                     <span>Quinta-feira</span>
                                                 </label>
                                                 <label class="checkbox-label">
                                                     <input type="checkbox" name="dias_aula_presencial[]" value="Sexta-feira" {% if duplicate_data and duplicate_data.dias_aula_unidades[i] and 'Sexta-feira' in duplicate_data.dias_aula_unidades[i] %}checked{% endif %}>
                                                     <span>Sexta-feira</span>
                                                 </label>
                                                 <label class="checkbox-label">
                                                     <input type="checkbox" name="dias_aula_presencial[]" value="S√°bado" {% if duplicate_data and duplicate_data.dias_aula_unidades[i] and 'S√°bado' in duplicate_data.dias_aula_unidades[i] %}checked{% endif %}>
                                                     <span>S√°bado</span>
                                                 </label>
                                                 <label class="checkbox-label">
                                                     <input type="checkbox" name="dias_aula_presencial[]" value="Domingo" {% if duplicate_data and duplicate_data.dias_aula_unidades[i] and 'Domingo' in duplicate_data.dias_aula_unidades[i] %}checked{% endif %}>
                                                     <span>Domingo</span>
                                                 </label>
                                             </div>
                                         </div>
                                     {% endfor %}
                                     {% else %}
                                     <!-- Primeira unidade padr√£o (quando n√£o h√° duplica√ß√£o) -->
                                     <div class="unidade-item" data-unidade="0">
                                         <label>Endere√ßo da unidade*</label>
                                         <input type="text" name="endereco_unidade[]" required>
                                         <label>Bairro*</label>
                                         <input type="text" name="bairro_unidade[]" required>
                                         <label>Total de vagas*</label>
                                         <input type="number" name="vagas_unidade[]" min="1" required>

                                         <div class="data-group">
                                             <div class="data-field">
                                                 <label>In√≠cio das aulas*</label>
                                                 <input type="date" name="inicio_aulas_data[]" required>
                                             </div>
                                             <div class="data-field">
                                                 <label>Fim das aulas*</label>
                                                 <input type="date" name="fim_aulas_data[]" required>
                                             </div>
                                         </div>
                                         <div class="horario-group">
                                             <div class="horario-field">
                                                 <label>Hor√°rio-In√≠cio*</label>
                                                 <select name="horario_inicio[]" required>
                                                     <option value="">Selecione o hor√°rio</option>
                                                     <option value="06:00">06:00</option>
                                                     <option value="07:00">07:00</option>
                                                     <option value="08:00">08:00</option>
                                                     <option value="09:00">09:00</option>
                                                     <option value="10:00">10:00</option>
                                                     <option value="11:00">11:00</option>
                                                     <option value="12:00">12:00</option>
                                                     <option value="13:00">13:00</option>
                                                     <option value="14:00">14:00</option>
                                                     <option value="15:00">15:00</option>
                                                     <option value="16:00">16:00</option>
                                                     <option value="17:00">17:00</option>
                                                     <option value="18:00">18:00</option>
                                                     <option value="19:00">19:00</option>
                                                     <option value="20:00">20:00</option>
                                                     <option value="21:00">21:00</option>
                                                     <option value="22:00">22:00</option>
                                                     <option value="23:00">23:00</option>
                                                 </select>
                                             </div>
                                             <div class="horario-field">
                                                 <label>Hor√°rio-Fim*</label>
                                                 <select name="horario_fim[]" required>
                                                     <option value="">Selecione o hor√°rio</option>
                                                     <option value="06:00">06:00</option>
                                                     <option value="07:00">07:00</option>
                                                     <option value="08:00">08:00</option>
                                                     <option value="09:00">09:00</option>
                                                     <option value="10:00">10:00</option>
                                                     <option value="11:00">11:00</option>
                                                     <option value="12:00">12:00</option>
                                                     <option value="13:00">13:00</option>
                                                     <option value="14:00">14:00</option>
                                                     <option value="15:00">15:00</option>
                                                     <option value="16:00">16:00</option>
                                                     <option value="17:00">17:00</option>
                                                     <option value="18:00">18:00</option>
                                                     <option value="19:00">19:00</option>
                                                     <option value="20:00">20:00</option>
                                                     <option value="21:00">21:00</option>
                                                     <option value="22:00">22:00</option>
                                                     <option value="23:00">23:00</option>
                                                 </select>
                                             </div>
                                         </div>
                                         <label>Dias de aula*</label>
                                         <div class="checkbox-group dias-aula">
                                             <label class="checkbox-label">
                                                 <input type="checkbox" name="dias_aula_presencial[]" value="Segunda-feira">
                                                 <span>Segunda-feira</span>
                                             </label>
                                             <label class="checkbox-label">
                                                 <input type="checkbox" name="dias_aula_presencial[]" value="Ter√ßa-feira">
                                                 <span>Ter√ßa-feira</span>
                                             </label>
                                             <label class="checkbox-label">
                                                 <input type="checkbox" name="dias_aula_presencial[]" value="Quarta-feira">
                                                 <span>Quarta-feira</span>
                                             </label>
                                             <label class="checkbox-label">
                                                 <input type="checkbox" name="dias_aula_presencial[]" value="Quinta-feira">
                                                 <span>Quinta-feira</span>
                                             </label>
                                             <label class="checkbox-label">
                                                 <input type="checkbox" name="dias_aula_presencial[]" value="Sexta-feira">
                                                 <span>Sexta-feira</span>
                                             </label>
                                             <label class="checkbox-label">
                                                 <input type="checkbox" name="dias_aula_presencial[]" value="S√°bado">
                                                 <span>S√°bado</span>
                                             </label>
                                             <label class="checkbox-label">
                                                 <input type="checkbox" name="dias_aula_presencial[]" value="Domingo">
                                                 <span>Domingo</span>
                                             </label>
                                         </div>
                                     </div>
                                     {% endif %}
                                     </div>
                                     
                                     <button type="button" class="btn btn-outline add-unidade-btn">+ Adicionar outra unidade</button>
                                 </fieldset>
                             </div>

                             <!-- Subformul√°rio para Online -->
                             <div class="form-group full-width" id="plataforma_container" style="display:{% if duplicate_data and duplicate_data.modalidade == 'Online' %}block{% else %}none{% endif %};">
                                 <fieldset class="unidade-fieldset">
                                     <legend>Informa√ß√µes da Plataforma <button type="button" class="remove-plataforma-btn" onclick="removePlataforma(this)" style="display:none;">&times;</button></legend>
                                     
                                     <!-- Container para plataforma online -->
                                     <div id="plataforma_list">
                                         <!-- Informa√ß√µes da plataforma online -->
                                         <div class="plataforma-item" data-plataforma="0">
                                             <label for="plataforma_digital">Plataforma Digital</label>
                                             <input type="text" id="plataforma_digital" name="plataforma_digital" 
                                                    placeholder="Ex: Zoom, Google Meet, Microsoft Teams" value="{{ duplicate_data.plataforma_digital if duplicate_data else '' }}">
                                             
                                             <label for="total_vagas_online">Total de vagas*</label>
                                             <input type="number" id="total_vagas_online" name="vagas_unidade[]" min="1" required
                                                    placeholder="Digite o n√∫mero total de vagas" value="{{ duplicate_data.total_vagas_online if duplicate_data else '' }}">

                                             <label class="required">Aulas Ass√≠ncronas?</label>
                                             <div class="radio-group">
                                                 <label class="radio-label">
                                                     <input type="radio" name="aulas_assincronas" value="sim" required {% if duplicate_data and duplicate_data.tipo_aulas_online == 'assincronas' %}checked{% else %}checked{% endif %} onclick="toggleAulasAssincronas(true)"> SIM
                                                 </label>
                                                 <label class="radio-label">
                                                     <input type="radio" name="aulas_assincronas" value="nao" required {% if duplicate_data and duplicate_data.tipo_aulas_online == 'sincronas' %}checked{% endif %} onclick="toggleAulasAssincronas(false)"> N√ÉO
                                                 </label>
                                             </div>
                                             
                                             <div class="data-group" id="horarios_online_container">
                                                 <div class="data-field">
                                                     <label>In√≠cio das aulas</label>
                                                     <input type="date" id="inicio_aulas_online" name="inicio_aulas_data[]" value="{{ duplicate_data.inicio_aulas_online if duplicate_data else '' }}">
                                                 </div>
                                                 <div class="data-field">
                                                     <label>Fim das aulas</label>
                                                     <input type="date" id="fim_aulas_online" name="fim_aulas_data[]" value="{{ duplicate_data.fim_aulas_online if duplicate_data else '' }}">
                                                 </div>
                                             </div>
                                             <div id="horarios_detalhados_online_container" style="display: none;">
                                                 <div class="horario-group">
                                                     <div class="horario-field">
                                                         <label>Hor√°rio-In√≠cio</label>
                                                         <select id="horario_inicio_online" name="horario_inicio[]">
                                                             <option value="">Selecione o hor√°rio</option>
                                                             <option value="06:00" {% if duplicate_data and duplicate_data.horario_inicio_online == '06:00' %}selected{% endif %}>06:00</option>
                                                             <option value="07:00" {% if duplicate_data and duplicate_data.horario_inicio_online == '07:00' %}selected{% endif %}>07:00</option>
                                                             <option value="08:00" {% if duplicate_data and duplicate_data.horario_inicio_online == '08:00' %}selected{% endif %}>08:00</option>
                                                             <option value="09:00" {% if duplicate_data and duplicate_data.horario_inicio_online == '09:00' %}selected{% endif %}>09:00</option>
                                                             <option value="10:00" {% if duplicate_data and duplicate_data.horario_inicio_online == '10:00' %}selected{% endif %}>10:00</option>
                                                             <option value="11:00" {% if duplicate_data and duplicate_data.horario_inicio_online == '11:00' %}selected{% endif %}>11:00</option>
                                                             <option value="12:00" {% if duplicate_data and duplicate_data.horario_inicio_online == '12:00' %}selected{% endif %}>12:00</option>
                                                             <option value="13:00" {% if duplicate_data and duplicate_data.horario_inicio_online == '13:00' %}selected{% endif %}>13:00</option>
                                                             <option value="14:00" {% if duplicate_data and duplicate_data.horario_inicio_online == '14:00' %}selected{% endif %}>14:00</option>
                                                             <option value="15:00" {% if duplicate_data and duplicate_data.horario_inicio_online == '15:00' %}selected{% endif %}>15:00</option>
                                                             <option value="16:00" {% if duplicate_data and duplicate_data.horario_inicio_online == '16:00' %}selected{% endif %}>16:00</option>
                                                             <option value="17:00" {% if duplicate_data and duplicate_data.horario_inicio_online == '17:00' %}selected{% endif %}>17:00</option>
                                                             <option value="18:00" {% if duplicate_data and duplicate_data.horario_inicio_online == '18:00' %}selected{% endif %}>18:00</option>
                                                             <option value="19:00" {% if duplicate_data and duplicate_data.horario_inicio_online == '19:00' %}selected{% endif %}>19:00</option>
                                                             <option value="20:00" {% if duplicate_data and duplicate_data.horario_inicio_online == '20:00' %}selected{% endif %}>20:00</option>
                                                             <option value="21:00" {% if duplicate_data and duplicate_data.horario_inicio_online == '21:00' %}selected{% endif %}>21:00</option>
                                                             <option value="22:00" {% if duplicate_data and duplicate_data.horario_inicio_online == '22:00' %}selected{% endif %}>22:00</option>
                                                             <option value="23:00" {% if duplicate_data and duplicate_data.horario_inicio_online == '23:00' %}selected{% endif %}>23:00</option>
                                                         </select>
                                                     </div>
                                                     <div class="horario-field">
                                                         <label>Hor√°rio-Fim</label>
                                                         <select id="horario_fim_online" name="horario_fim[]">
                                                             <option value="">Selecione o hor√°rio</option>
                                                             <option value="06:00" {% if duplicate_data and duplicate_data.horario_fim_online == '06:00' %}selected{% endif %}>06:00</option>
                                                             <option value="07:00" {% if duplicate_data and duplicate_data.horario_fim_online == '07:00' %}selected{% endif %}>07:00</option>
                                                             <option value="08:00" {% if duplicate_data and duplicate_data.horario_fim_online == '08:00' %}selected{% endif %}>08:00</option>
                                                             <option value="09:00" {% if duplicate_data and duplicate_data.horario_fim_online == '09:00' %}selected{% endif %}>09:00</option>
                                                             <option value="10:00" {% if duplicate_data and duplicate_data.horario_fim_online == '10:00' %}selected{% endif %}>10:00</option>
                                                             <option value="11:00" {% if duplicate_data and duplicate_data.horario_fim_online == '11:00' %}selected{% endif %}>11:00</option>
                                                             <option value="12:00" {% if duplicate_data and duplicate_data.horario_fim_online == '12:00' %}selected{% endif %}>12:00</option>
                                                             <option value="13:00" {% if duplicate_data and duplicate_data.horario_fim_online == '13:00' %}selected{% endif %}>13:00</option>
                                                             <option value="14:00" {% if duplicate_data and duplicate_data.horario_fim_online == '14:00' %}selected{% endif %}>14:00</option>
                                                             <option value="15:00" {% if duplicate_data and duplicate_data.horario_fim_online == '15:00' %}selected{% endif %}>15:00</option>
                                                             <option value="16:00" {% if duplicate_data and duplicate_data.horario_fim_online == '16:00' %}selected{% endif %}>16:00</option>
                                                             <option value="17:00" {% if duplicate_data and duplicate_data.horario_fim_online == '17:00' %}selected{% endif %}>17:00</option>
                                                             <option value="18:00" {% if duplicate_data and duplicate_data.horario_fim_online == '18:00' %}selected{% endif %}>18:00</option>
                                                             <option value="19:00" {% if duplicate_data and duplicate_data.horario_fim_online == '19:00' %}selected{% endif %}>19:00</option>
                                                             <option value="20:00" {% if duplicate_data and duplicate_data.horario_fim_online == '20:00' %}selected{% endif %}>20:00</option>
                                                             <option value="21:00" {% if duplicate_data and duplicate_data.horario_fim_online == '21:00' %}selected{% endif %}>21:00</option>
                                                             <option value="22:00" {% if duplicate_data and duplicate_data.horario_fim_online == '22:00' %}selected{% endif %}>22:00</option>
                                                             <option value="23:00" {% if duplicate_data and duplicate_data.horario_fim_online == '23:00' %}selected{% endif %}>23:00</option>
                                                         </select>
                                                     </div>
                                                 </div>
                                                 <label>Dias de aula</label>
                                                 <div class="checkbox-group dias-aula">
                                                     <label class="checkbox-label">
                                                         <input type="checkbox" name="dias_aula_online[]" value="Segunda-feira" {% if duplicate_data and 'Segunda-feira' in duplicate_data.dias_aula %}checked{% endif %}>
                                                         <span>Segunda-feira</span>
                                                     </label>
                                                     <label class="checkbox-label">
                                                         <input type="checkbox" name="dias_aula_online[]" value="Ter√ßa-feira" {% if duplicate_data and 'Ter√ßa-feira' in duplicate_data.dias_aula %}checked{% endif %}>
                                                         <span>Ter√ßa-feira</span>
                                                     </label>
                                                     <label class="checkbox-label">
                                                         <input type="checkbox" name="dias_aula_online[]" value="Quarta-feira" {% if duplicate_data and 'Quarta-feira' in duplicate_data.dias_aula %}checked{% endif %}>
                                                         <span>Quarta-feira</span>
                                                     </label>
                                                     <label class="checkbox-label">
                                                         <input type="checkbox" name="dias_aula_online[]" value="Quinta-feira" {% if duplicate_data and 'Quinta-feira' in duplicate_data.dias_aula %}checked{% endif %}>
                                                         <span>Quinta-feira</span>
                                                     </label>
                                                     <label class="checkbox-label">
                                                         <input type="checkbox" name="dias_aula_online[]" value="Sexta-feira" {% if duplicate_data and 'Sexta-feira' in duplicate_data.dias_aula %}checked{% endif %}>
                                                         <span>Sexta-feira</span>
                                                     </label>
                                                     <label class="checkbox-label">
                                                         <input type="checkbox" name="dias_aula_online[]" value="S√°bado" {% if duplicate_data and 'S√°bado' in duplicate_data.dias_aula %}checked{% endif %}>
                                                         <span>S√°bado</span>
                                                     </label>
                                                     <label class="checkbox-label">
                                                         <input type="checkbox" name="dias_aula_online[]" value="Domingo" {% if duplicate_data and 'Domingo' in duplicate_data.dias_aula %}checked{% endif %}>
                                                         <span>Domingo</span>
                                                     </label>
                                                 </div>
                                             </div>
                                         </div>
                                     </div>
                                     
                                     <button type="button" class="btn btn-outline add-plataforma-btn">+ Adicionar outra plataforma</button>
                                 </fieldset>
                            </div>   
                         
                            <div class="form-group full-width">
                                <label for="acessibilidade" class="required">Acessibilidade</label>
                                <select id="acessibilidade" name="acessibilidade" required onchange="toggleRecursosAcessibilidade()">
                                    <option value="">Selecione uma op√ß√£o</option>
                                    <option value="acessivel" {% if duplicate_data and duplicate_data.acessibilidade == 'acessivel' %}selected{% endif %}>Acess√≠vel para pessoas com defici√™ncia</option>
                                    <option value="exclusivo" {% if duplicate_data and duplicate_data.acessibilidade == 'exclusivo' %}selected{% endif %}>Exclusivo para pessoas com defici√™ncia</option>
                                    <option value="nao_acessivel" {% if duplicate_data and duplicate_data.acessibilidade == 'nao_acessivel' %}selected{% endif %}>N√£o acess√≠vel para Pessoas com Defici√™ncia</option>
                                </select>
                            </div>

                            <div class="form-group full-width" id="recursos_acessibilidade_container" style="display: {% if duplicate_data and (duplicate_data.acessibilidade == 'acessivel' or duplicate_data.acessibilidade == 'exclusivo') %}block{% else %}none{% endif %};">
                                <label for="recursos_acessibilidade" class="required">Recursos de Acessibilidade</label>
                                <textarea id="recursos_acessibilidade" name="recursos_acessibilidade" rows="3"
                                          placeholder="Ex: Int√©rprete de Libras, material em Braille, rampa de acesso, elevador...">{{ duplicate_data.recursos_acessibilidade if duplicate_data else '' }}</textarea>
                            </div>

                            <div class="form-group full-width">
                                <label for="publico_alvo" class="required">P√∫blico-alvo</label>
                                <textarea id="publico_alvo" name="publico_alvo" required rows="3"
                                          placeholder="Ex: Servidores p√∫blicos, estudantes, profissionais da √°rea de tecnologia...">{{ duplicate_data.publico_alvo if duplicate_data else '' }}</textarea>
                            </div>

                            <div class="form-group full-width">
                                <label class="required">O curso √© gratuito?</label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="curso_gratuito" value="sim" required onclick="toggleValorCurso(false)" {% if duplicate_data and duplicate_data.curso_gratuito == 'sim' %}checked{% endif %}> SIM
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="curso_gratuito" value="nao" required onclick="toggleValorCurso(true)" {% if duplicate_data and duplicate_data.curso_gratuito == 'nao' %}checked{% endif %}> N√ÉO
                                    </label>
                                </div>
                            </div>

                            <div class="form-group full-width" id="valor_curso_container" style="display: {% if duplicate_data and duplicate_data.curso_gratuito == 'nao' %}block{% else %}none{% endif %};">
                                <div class="valor-curso-row">
                                    <div class="valor-curso-col">
                                        <label for="valor_curso_inteira" class="required">Valor INTEIRA (R$)</label>
                                        <input type="text" id="valor_curso_inteira" name="valor_curso_inteira" step="0.01" min="0"
                                            placeholder="Digite o valor integral (ex: 100,00)" oninput="formatarValor(this)" value="{{ duplicate_data.valor_curso_inteira if duplicate_data else '' }}">
                                    </div>
                                    <div class="valor-curso-col">
                                        <label for="valor_curso_meia">Valor MEIA (R$)</label>
                                        <input type="text" id="valor_curso_meia" name="valor_curso_meia" step="0.01" min="0"
                                            placeholder="Digite o valor da meia (ex: 50,00)" oninput="formatarValor(this); toggleRequisitos()" value="{{ duplicate_data.valor_curso_meia if duplicate_data else '' }}">
                                    </div>
                                </div>
                                <div id="requisitos_meia_container" style="display: {% if duplicate_data and duplicate_data.valor_curso_meia %}block{% else %}none{% endif %};">
                                    <label for="requisitos_meia" class="required">Condi√ß√µes para obten√ß√£o de meia-entrada</label>
                                    <textarea id="requisitos_meia" name="requisitos_meia" rows="2"
                                        placeholder="Ex: Estudantes, idosos, pessoas com defici√™ncia...">{{ duplicate_data.requisitos_meia if duplicate_data else '' }}</textarea>
                                </div>
                             </div>

                            <div class="form-group full-width">
                                <label class="required">Oferece Certificado</label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="oferece_certificado" value="sim" required onclick="togglePreRequisitos(true)" {% if duplicate_data and duplicate_data.oferece_certificado == 'sim' %}checked{% endif %}> SIM
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="oferece_certificado" value="nao" required onclick="togglePreRequisitos(false)" {% if duplicate_data and duplicate_data.oferece_certificado == 'nao' %}checked{% endif %}> N√ÉO
                                    </label>
                                </div>
                            </div>

                            <div class="form-group full-width" id="pre_requisitos_container" style="display: {% if duplicate_data and duplicate_data.oferece_certificado == 'sim' %}block{% else %}none{% endif %};">
                                <label for="pre_requisitos" class="required">Pr√©-requisitos para Recebimento de Certificados</label>
                                <textarea id="pre_requisitos" name="pre_requisitos" rows="3"
                                          placeholder="Ex: Frequ√™ncia m√≠nima de 75%, entrega de trabalho final, aprova√ß√£o em avalia√ß√£o...">{{ duplicate_data.pre_requisitos if duplicate_data else '' }}</textarea>
                            </div>

                            <div class="form-group full-width">
                                <label class="required">Oferece Bolsa</label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="oferece_bolsa" value="sim" required onclick="toggleValorBolsa(true)" {% if duplicate_data and duplicate_data.oferece_bolsa == 'sim' %}checked{% endif %}> SIM
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="oferece_bolsa" value="nao" required onclick="toggleValorBolsa(false)" {% if duplicate_data and duplicate_data.oferece_bolsa == 'nao' %}checked{% endif %}> N√ÉO
                                    </label>
                                </div>
                            </div>

                            <div class="form-group full-width" id="valor_bolsa_container" style="display: {% if duplicate_data and duplicate_data.oferece_bolsa == 'sim' %}block{% else %}none{% endif %};">
                                <label for="valor_bolsa">Valor da Bolsa (R$)</label>
                                <input type="text" id="valor_bolsa" name="valor_bolsa" step="0.01" min="0"
                                       placeholder="Digite o valor da bolsa (ex: 100,00)" oninput="formatarValor(this)" value="{{ duplicate_data.valor_bolsa if duplicate_data else '' }}">
                            </div>
                            
                            <div class="form-group full-width" id="requisitos_bolsa_container" style="display: {% if duplicate_data and duplicate_data.oferece_bolsa == 'sim' %}block{% else %}none{% endif %};">
                                <label for="requisitos_bolsa">Requisitos para a Obten√ß√£o da Bolsa</label>
                                <textarea id="requisitos_bolsa" name="requisitos_bolsa" rows="3"
                                          placeholder="Descreva os requisitos necess√°rios para obten√ß√£o da bolsa">{{ duplicate_data.requisitos_bolsa if duplicate_data else '' }}</textarea>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="info_complementares">Informa√ß√µes Complementares para inscri√ß√£o de participantes</label>
                                <span style="color:red; font-size:0.9em; display:block; margin:4px 0 8px;">OBS: Com o acesso via gov.br, j√° teremos o Nome e CPF do candidato.</span>
                                <textarea id="info_complementares" name="info_complementares" rows="4"
                                          placeholder="Informe quais dados ser√£o necess√°rios para inscri√ß√£o dos participantes (Ex: Escolaridade, Idade, Bairro, etc.)">{{ duplicate_data.info_complementares if duplicate_data else '' }}</textarea>                        
                            </div>

                            <!-- Pergunta: Informa√ß√µes adicionais do curso? -->
                            <div class="form-group full-width">
                                <label class="required">Informa√ß√µes adicionais do curso?</label>
                                <span style="color:red; font-size: 0.9em; display:block; margin:4px 0 8px;">Para divulgar o curso de forma clara e objetiva, o foco deve ser em apresentar somente as informa√ß√µes mais importantes. Detalhes adicionais podem ser comunicados aos alunos que se matricularem, por isso, avalie se esses dados s√£o realmente essenciais para o p√∫blico geral no momento da divulga√ß√£o.</span>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="info_adicionais_opcao" value="sim" required onclick="toggleInfoAdicionais(true)" {% if duplicate_data and duplicate_data.info_adicionais_opcao == 'sim' %}checked{% endif %}> SIM
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="info_adicionais_opcao" value="nao" required onclick="toggleInfoAdicionais(false)" {% if duplicate_data and duplicate_data.info_adicionais_opcao == 'nao' %}checked{% endif %}> N√ÉO
                                    </label>
                                </div>
                            </div>

                            <div class="form-group full-width" id="info_adicionais_container" style="display: {% if duplicate_data and duplicate_data.info_adicionais_opcao == 'sim' %}block{% else %}none{% endif %};">
                                <label for="info_adicionais">Informa√ß√µes Adicionais do Curso</label>
                                <textarea id="info_adicionais" name="info_complementares" rows="4" placeholder="Digite informa√ß√µes adicionais, como recursos utilizados, facilitador, etc">{{ duplicate_data.info_complementares if duplicate_data else '' }}</textarea>
                            </div>
                            
                            <!-- Parceiro Externo -->
                            <div class="form-group full-width">
                                <label class="required">CURSO OFERECIDO POR PARCEIRO EXTERNO?</label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="parceiro_externo" value="sim" required onclick="toggleParceiroExterno(true)" {% if duplicate_data and duplicate_data.parceiro_externo == 'sim' %}checked{% endif %}> SIM
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="parceiro_externo" value="nao" required onclick="toggleParceiroExterno(false)" {% if duplicate_data and duplicate_data.parceiro_externo == 'nao' %}checked{% endif %}> N√ÉO
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-group full-width" id="parceiro_externo_container" style="display: {% if duplicate_data and duplicate_data.parceiro_externo == 'sim' %}block{% else %}none{% endif %};">
                                <fieldset class="unidade-fieldset">
                                    <legend>Informa√ß√µes do Parceiro</legend>
                                    
                                    <div class="parceiro-grid">
                                        <div class="parceiro-item">
                                            <label for="parceiro_nome">Nome do Parceiro</label>
                                            <input type="text" id="parceiro_nome" name="parceiro_nome" placeholder="Ex: Funda√ß√£o Exemplo" value="{{ duplicate_data.parceiro_nome if duplicate_data else '' }}">
                                        </div>
                                        
                                        <div class="parceiro-item">
                                            <label for="parceiro_logo">Logo do Parceiro</label>
                                            <input type="file" id="parceiro_logo" name="parceiro_logo" accept=".png,.jpg,.jpeg,image/*">
                                            <small class="file-hint">Formatos aceitos: PNG, JPG, JPEG</small>
                                        </div>
                                        
                                        <div class="parceiro-item full-width">
                                            <label for="parceiro_link">Link do Parceiro</label>
                                            <input type="text" id="parceiro_link" name="parceiro_link" placeholder="https://exemplo.org" value="{{ duplicate_data.parceiro_link if duplicate_data else '' }}">
                                            <small class="help-text-red">Link da p√°gina web para onde o usu√°rio ser√° redirecionado para fins de inscri√ß√£o na plataforma do parceiro</small>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <a href="{{ url_for('public_courses') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Voltar
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Criar Curso
                        </button>
                    </div>
                </form>
            </div>
        </main>    <
/div>
    
    <script>
        function toggleValorCurso(mostrar) {
            const valorCursoContainer = document.getElementById('valor_curso_container');
            if (valorCursoContainer) {
                valorCursoContainer.style.display = mostrar ? 'block' : 'none';
            }
        }

        function togglePreRequisitos(mostrar) {
            const preRequisitosContainer = document.getElementById('pre_requisitos_container');
            if (preRequisitosContainer) {
                preRequisitosContainer.style.display = mostrar ? 'block' : 'none';
            }
        }

        function toggleRecursosAcessibilidade() {
            const acessibilidadeSelect = document.getElementById('acessibilidade');
            const recursosContainer = document.getElementById('recursos_acessibilidade_container');
            if (acessibilidadeSelect && recursosContainer) {
                recursosContainer.style.display = (acessibilidadeSelect.value === 'acessivel' || acessibilidadeSelect.value === 'exclusivo') ? 'block' : 'none';
            }
        }

        function toggleValorBolsa(mostrar) {
            const valorBolsaContainer = document.getElementById('valor_bolsa_container');
            const requisitosContainer = document.getElementById('requisitos_bolsa_container');
            if (valorBolsaContainer) valorBolsaContainer.style.display = mostrar ? 'block' : 'none';
            if (requisitosContainer) requisitosContainer.style.display = mostrar ? 'block' : 'none';
        }

        function toggleParceiroExterno(mostrar) {
            const container = document.getElementById('parceiro_externo_container');
            if (container) {
                container.style.display = mostrar ? 'block' : 'none';
            }
        }

        function toggleInfoAdicionais(mostrar) {
            const container = document.getElementById('info_adicionais_container');
            if (container) {
                container.style.display = mostrar ? 'block' : 'none';
            }
        }

        function toggleUnidades() {
            const modalidade = document.getElementById('modalidade').value;
            const unidadesContainer = document.getElementById('unidades_container');
            const plataformaContainer = document.getElementById('plataforma_container');
            
            console.log('üîÑ toggleUnidades chamado, modalidade:', modalidade);
            
            // Esconder ambos os containers primeiro
            if (unidadesContainer) unidadesContainer.style.display = 'none';
            if (plataformaContainer) plataformaContainer.style.display = 'none';
            
            // Remover required de TODOS os campos de modalidade E limpar valores
            const allModalidadeFields = document.querySelectorAll('#unidades_container input, #unidades_container select, #plataforma_container input, #plataforma_container select');
            allModalidadeFields.forEach(field => {
                field.removeAttribute('required');
                // N√£o limpar valores aqui - apenas quando necess√°rio
                console.log('‚ùå Removido required de:', field.name || field.id);
            });
            
            if (modalidade === 'Presencial' || modalidade === 'H√≠brido') {
                if (unidadesContainer) {
                    unidadesContainer.style.display = 'block';
                    console.log('‚úÖ Mostrando container de unidades');
                    
                    // Adicionar required apenas aos campos espec√≠ficos de unidades
                    const camposObrigatoriosUnidades = [
                        'input[name="endereco_unidade[]"]',
                        'input[name="bairro_unidade[]"]', 
                        'input[name="vagas_unidade[]"]',
                        'input[name="inicio_aulas_data[]"]',
                        'input[name="fim_aulas_data[]"]',
                        'select[name="horario_inicio[]"]',
                        'select[name="horario_fim[]"]'
                    ];
                    
                    camposObrigatoriosUnidades.forEach(seletor => {
                        const campos = unidadesContainer.querySelectorAll(seletor);
                        campos.forEach(campo => {
                            campo.setAttribute('required', 'required');
                            console.log('‚úÖ Adicionado required a:', campo.name);
                        });
                    });
                }
            } else if (modalidade === 'Online') {
                if (plataformaContainer) {
                    plataformaContainer.style.display = 'block';
                    console.log('‚úÖ Mostrando container de plataforma');
                    
                    // Garantir que os campos obrigat√≥rios da modalidade online tenham required
                    const camposObrigatoriosPlataforma = [
                        'input[name="inicio_aulas_online"]',
                        'input[name="fim_aulas_online"]',
                        'input[name="aulas_assincronas"]'
                    ];
                    
                    // Adicionar required ao campo de vagas online (que usa name="vagas_unidade[]" mas est√° no container de plataforma)
                    const vagasOnline = plataformaContainer.querySelector('#total_vagas_online');
                    if (vagasOnline) {
                        vagasOnline.setAttribute('required', 'required');
                        console.log('‚úÖ Adicionado required a vagas online');
                    }
                    
                    camposObrigatoriosPlataforma.forEach(seletor => {
                        const campos = plataformaContainer.querySelectorAll(seletor);
                        campos.forEach(campo => {
                            campo.setAttribute('required', 'required');
                            console.log('‚úÖ Adicionado required a:', campo.name);
                        });
                    });
                    
                    // NUNCA adicionar required aos campos de hor√°rio aqui
                    // Eles ser√£o gerenciados pela fun√ß√£o toggleAulasAssincronas
                    const horariosOnline = plataformaContainer.querySelectorAll('select[name="horario_inicio[]"], select[name="horario_fim[]"]');
                    horariosOnline.forEach(campo => {
                        campo.removeAttribute('required');
                        console.log('‚ùå Garantindo que hor√°rio n√£o tenha required inicialmente:', campo.name);
                    });
                    
                    // Chamar toggleAulasAssincronas para configurar corretamente os hor√°rios
                    setTimeout(() => {
                        const tipoAulaSelecionada = plataformaContainer.querySelector('input[name="aulas_assincronas"]:checked');
                        if (tipoAulaSelecionada) {
                            toggleAulasAssincronas(tipoAulaSelecionada.value === 'sim');
                        }
                    }, 100);
                }
            }
            
            console.log('üîÑ toggleUnidades conclu√≠do');
        }
        


        function toggleAulasAssincronas(isAssincronas) {
            const horariosContainer = document.getElementById('horarios_detalhados_online_container');
            const horariosOnlineContainer = document.getElementById('horarios_online_container');
            
            console.log('üîÑ toggleAulasAssincronas chamado, isAssincronas:', isAssincronas);
            
            if (horariosContainer && horariosOnlineContainer) {
                if (isAssincronas) {
                    // Aulas ass√≠ncronas - ocultar hor√°rios detalhados
                    horariosContainer.style.display = 'none';
                    horariosOnlineContainer.style.display = 'block';
                    
                    // Remover required E limpar valores dos campos de hor√°rio
                    const horariosFields = document.querySelectorAll('#plataforma_container select[name="horario_inicio[]"], #plataforma_container select[name="horario_fim[]"]');
                    horariosFields.forEach(field => {
                        field.removeAttribute('required');
                        field.value = ''; // Limpar valor para aulas ass√≠ncronas
                        console.log('‚ùå Removido required e limpo valor de hor√°rio ass√≠ncrono:', field.name || field.id);
                    });
                } else {
                    // Aulas s√≠ncronas - mostrar hor√°rios detalhados
                    horariosContainer.style.display = 'block';
                    horariosOnlineContainer.style.display = 'block';
                    
                    // Adicionar required aos campos de hor√°rio
                    setTimeout(() => {
                        const horariosFields = horariosContainer.querySelectorAll('select[name="horario_inicio[]"], select[name="horario_fim[]"]');
                        horariosFields.forEach(field => {
                            field.setAttribute('required', 'required');
                            console.log('‚úÖ Adicionado required a hor√°rio s√≠ncrono:', field.name || field.id);
                        });
                    }, 50);
                }
            }
        }

        function formatarValor(input) {
            let valor = input.value.replace(/\D/g, '');
            valor = (valor / 100).toFixed(2) + '';
            valor = valor.replace(".", ",");
            valor = valor.replace(/(\d)(\d{3})(\d{3}),/g, "$1.$2.$3,");
            valor = valor.replace(/(\d)(\d{3}),/g, "$1.$2,");
            input.value = valor;
        }

        function toggleRequisitos() {
            const valorMeia = document.getElementById('valor_curso_meia');
            const requisitosContainer = document.getElementById('requisitos_meia_container');
            if (valorMeia && requisitosContainer) {
                requisitosContainer.style.display = valorMeia.value ? 'block' : 'none';
            }
        }
    </script>

    <!-- Script para limpar campos required ocultos -->
    <script>
        // Fun√ß√£o para limpar campos required ocultos - executada antes de qualquer valida√ß√£o
        function limparCamposRequiredOcultos() {
            const todosRequired = document.querySelectorAll('[required]');
            let removidos = 0;
            
            todosRequired.forEach(campo => {
                const rect = campo.getBoundingClientRect();
                const isHidden = rect.width === 0 && rect.height === 0;
                const parentHidden = campo.closest('[style*="display: none"], [style*="display:none"]');
                
                if (isHidden || parentHidden) {
                    campo.removeAttribute('required');
                    removidos++;
                    console.log('üßπ Campo required oculto removido:', campo.name || campo.id);
                }
            });
            
            if (removidos > 0) {
                console.log('‚úÖ Total de campos required ocultos removidos:', removidos);
            }
            
            return removidos;
        }
        
        // Executar a limpeza periodicamente
        setInterval(limparCamposRequiredOcultos, 1000);
        
        // Executar antes de qualquer submit
        document.addEventListener('submit', function(e) {
            console.log('üîç Limpeza final antes do submit...');
            limparCamposRequiredOcultos();
            limparCamposOcultosAntesDosSubmit();
        }, true);
        
        // Fun√ß√£o para limpar valores de campos ocultos antes do submit
        function limparCamposOcultosAntesDosSubmit() {
            const modalidade = document.getElementById('modalidade').value;
            console.log('üßπ Limpando campos baseado na modalidade:', modalidade);
            
            if (modalidade === 'Online') {
                // Limpar campos de unidades presenciais (mas n√£o vagas online)
                const camposPresenciais = [
                    'input[name="endereco_unidade[]"]',
                    'input[name="bairro_unidade[]"]',
                    'input[name="inicio_aulas_data[]"]',
                    'input[name="fim_aulas_data[]"]',
                    'select[name="horario_inicio[]"]',
                    'select[name="horario_fim[]"]'
                ];
                
                camposPresenciais.forEach(seletor => {
                    const campos = document.querySelectorAll(seletor);
                    campos.forEach(campo => {
                        if (campo.closest('#unidades_container')) {
                            campo.value = '';
                            console.log('üßπ Valor limpo de campo presencial:', campo.name);
                        }
                    });
                });
                
                // Limpar apenas vagas de unidades presenciais (n√£o online)
                const vagasPresenciais = document.querySelectorAll('#unidades_container input[name="vagas_unidade[]"]');
                vagasPresenciais.forEach(campo => {
                    campo.value = '';
                    console.log('üßπ Valor limpo de vagas presencial:', campo.name);
                });
                
                // Para modalidade online, verificar se √© ass√≠ncrona
                const tipoAulaAssincronas = document.querySelector('input[name="aulas_assincronas"]:checked');
                if (tipoAulaAssincronas && tipoAulaAssincronas.value === 'sim') {
                    // Limpar hor√°rios para aulas ass√≠ncronas
                    const horariosOnline = document.querySelectorAll('#plataforma_container select[name="horario_inicio[]"], #plataforma_container select[name="horario_fim[]"]');
                    horariosOnline.forEach(campo => {
                        campo.value = '';
                        console.log('üßπ Valor limpo de hor√°rio ass√≠ncrono:', campo.name);
                    });
                    
                    // Limpar checkboxes de dias da semana para aulas ass√≠ncronas
                    const diasAulaOnline = document.querySelectorAll('#plataforma_container input[name="dias_aula_online[]"]');
                    diasAulaOnline.forEach(checkbox => {
                        checkbox.checked = false;
                        console.log('üßπ Desmarcado dia da semana para aula ass√≠ncrona:', checkbox.value);
                    });
                }
                
            } else if (modalidade === 'Presencial' || modalidade === 'H√≠brido') {
                // Limpar campos de plataforma online
                const camposOnline = [
                    'input[name="plataforma_digital"]',
                    'input[name="inicio_aulas_online"]',
                    'input[name="fim_aulas_online"]',
                    'input[name="aulas_assincronas"]'
                ];
                
                camposOnline.forEach(seletor => {
                    const campos = document.querySelectorAll(seletor);
                    campos.forEach(campo => {
                        campo.value = '';
                        console.log('üßπ Valor limpo de campo online:', campo.name);
                    });
                });
                
                // Limpar vagas online usando o ID correto
                const vagasOnline = document.querySelector('#total_vagas_online');
                if (vagasOnline) {
                    vagasOnline.value = '';
                    console.log('üßπ Valor limpo de vagas online');
                }
                
                // Limpar hor√°rios online
                const horariosOnline = document.querySelectorAll('#plataforma_container select[name="horario_inicio[]"], #plataforma_container select[name="horario_fim[]"]');
                horariosOnline.forEach(campo => {
                    campo.value = '';
                    console.log('üßπ Valor limpo de hor√°rio online:', campo.name);
                });
            }
        }
        
        // Executar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(limparCamposRequiredOcultos, 500);
        });
    </script>

    <!-- Scripts JavaScript -->
    <script src="{{ url_for('static', filename='js/loading-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/form-validator.js') }}"></script>
    <script src="{{ url_for('static', filename='js/form-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/image-resizer.js') }}"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
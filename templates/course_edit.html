<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Curso - Ciclo Carioca</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Função para formatar datas no formato brasileiro
            function formatarDataBrasileira() {
                const camposData = document.querySelectorAll('input[type="date"]');
                camposData.forEach(campo => {
                    campo.addEventListener('change', function() {
                        if (this.value) {
                            const [ano, mes, dia] = this.value.split('-');
                            const dataFormatada = `${dia}/${mes}/${ano}`;
                            // Exibe a data formatada em um elemento adjacente ou tooltip
                            this.setAttribute('title', `Data: ${dataFormatada}`);
                        }
                    });
                    // Formatar datas já preenchidas
                    if (campo.value) {
                        const [ano, mes, dia] = campo.value.split('-');
                        const dataFormatada = `${dia}/${mes}/${ano}`;
                        campo.setAttribute('title', `Data: ${dataFormatada}`);
                    }
                });
            }
            
            // Mostrar/ocultar campo de pré-requisitos com base na seleção de certificado
            const certificadoSelect = document.getElementById('oferece_certificado');
            const preRequisitosGroup = document.getElementById('pre_requisitos_group');
            
            if (certificadoSelect && preRequisitosGroup) {
                function togglePreRequisitos() {
                    if (certificadoSelect.value === 'sim') {
                        preRequisitosGroup.style.display = 'block';
                    } else {
                        preRequisitosGroup.style.display = 'none';
                    }
                }
                
                certificadoSelect.addEventListener('change', togglePreRequisitos);
                togglePreRequisitos(); // Executar na carga inicial
            }
            
            formatarDataBrasileira();
        });
    </script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo-section">
                    <a href="{{ url_for('index') }}" title="Ir para página inicial">
                        <img src="{{ url_for('static', filename='images/logo_ciclocarioca..png') }}" alt="Logo Ciclo Carioca">
                    </a>
                    <span class="version">v2.0</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="form-container">
                <div class="form-header">
                    <h2><i class="fas fa-edit"></i> Editar Curso</h2>
                    <p class="form-description">Atualize as informações do curso #{{ course.id }} - {{ course.titulo }}</p>
                </div>

                <!-- Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }}">
                                <i class="fas fa-{{ 'check-circle' if category == 'success' else 'exclamation-triangle' }}"></i>
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <form method="POST" action="{{ url_for('edit_course', course_id=course.id) }}" class="course-form" enctype="multipart/form-data">
                    <!-- Formulário de Edição de Curso -->
                    <div class="form-section">
                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label for="titulo" class="required">Nome do Curso</label>
                                <input type="text" id="titulo" name="titulo" required 
                                       placeholder="Digite o título do curso" value="{{ course.titulo }}">
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="descricao" class="required">Descrição</label>
                                <textarea id="descricao" name="descricao" rows="6" required
                                          placeholder="Digite a descrição do curso">{{ course.descricao }}</textarea>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="capa_curso">Capa do Curso</label>
                                <div class="file-upload-container">
                                    <input type="file" id="capa_curso" name="capa_curso" accept=".jpeg,.png,.jpg,.bmp,image/jpeg,image/png,image/jpg,image/bmp">
                                    <div class="file-upload-display">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <span class="file-upload-text">Clique para selecionar uma imagem</span>
                                        <span class="file-upload-hint">Formatos aceitos: JPEG, PNG, JPG, BMP</span>
                                    </div>
                                </div>
                                <small class="file-hint">A imagem será renomeada para o nome do curso e armazenada na pasta IMAGENSCURSOS</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="inicio_inscricoes" class="required">Início das inscrições</label>
                                <div class="datetime-group">
                                    <input type="date" id="inicio_inscricoes_data" name="inicio_inscricoes_data" value="{{ course.inicio_inscricoes_data }}" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="fim_inscricoes" class="required">Fim das inscrições</label>
                                <div class="datetime-group">
                                    <input type="date" id="fim_inscricoes_data" name="fim_inscricoes_data" value="{{ course.fim_inscricoes_data }}" required>
                                </div>
                            </div>
                            
                            <div class="form-group full-width">
                                 <label for="orgao" class="required">Órgão (Quem oferece o curso)</label>
                                 <select id="orgao" name="orgao" required>
                                     <option value="">Selecione um órgão</option>
                                     {% for orgao in orgaos %}
                                         <option value="{{ orgao }}" {% if course.orgao == orgao %}selected{% endif %}>{{ orgao }}</option>
                                     {% endfor %}
                                 </select>
                             </div>

                             
                             <div class="form-group full-width">
                                 <label for="tema" class="required">Categoria</label>
                                 <select id="tema" name="tema" required>
                                     <option value="">Selecione a categoria</option>
                                     <option value="Tech" {% if course.tema == 'Tech' %}selected{% endif %}>Tech</option>
                                     <option value="Dados" {% if course.tema == 'Dados' %}selected{% endif %}>Dados</option>
                                     <option value="IA" {% if course.tema == 'IA' %}selected{% endif %}>IA</option>
                                     <option value="Design" {% if course.tema == 'Design' %}selected{% endif %}>Design</option>
                                     <option value="Cibersegurança" {% if course.tema == 'Cibersegurança' %}selected{% endif %}>Cibersegurança</option>
                                     <option value="Marketing" {% if course.tema == 'Marketing' %}selected{% endif %}>Marketing</option>
                                     <option value="Finanças" {% if course.tema == 'Finanças' %}selected{% endif %}>Finanças</option>
                                     <option value="Gestão" {% if course.tema == 'Gestão' %}selected{% endif %}>Gestão</option>
                                     <option value="Games" {% if course.tema == 'Games' %}selected{% endif %}>Games</option>
                                     <option value="Nutrição" {% if course.tema == 'Nutrição' %}selected{% endif %}>Nutrição</option>
                                     <option value="Educação" {% if course.tema == 'Educação' %}selected{% endif %}>Educação</option>
                                     <option value="Gastronomia" {% if course.tema == 'Gastronomia' %}selected{% endif %}>Gastronomia</option>
                                     <option value="Saúde" {% if course.tema == 'Saúde' %}selected{% endif %}>Saúde</option>
                                     <option value="Veterinária" {% if course.tema == 'Veterinária' %}selected{% endif %}>Veterinária</option>
                                     <option value="Carreira" {% if course.tema == 'Carreira' %}selected{% endif %}>Carreira</option>
                                     <option value="Estética" {% if course.tema == 'Estética' %}selected{% endif %}>Estética</option>
                                     <option value="Sustentabilidade" {% if course.tema == 'Sustentabilidade' %}selected{% endif %}>Sustentabilidade</option>
                                     <option value="Artes" {% if course.tema == 'Artes' %}selected{% endif %}>Artes</option>
                                     <option value="Cultura" {% if course.tema == 'Cultura' %}selected{% endif %}>Cultura</option>
                                     <option value="Astronomia" {% if course.tema == 'Astronomia' %}selected{% endif %}>Astronomia</option>
                                 </select>
                             </div>
                            
                             <div class="form-group full-width">
                                 <label for="modalidade" class="required">Modalidade</label>
                                 <select id="modalidade" name="modalidade" required onchange="toggleUnidades();">
                                     <option value="">Selecione a modalidade</option>
                                     <option value="Presencial" {% if course.modalidade == 'Presencial' %}selected{% endif %}>Presencial</option>
                                     <option value="Online" {% if course.modalidade == 'Online' %}selected{% endif %}>Online</option>
                                     <option value="Híbrido" {% if course.modalidade == 'Híbrido' %}selected{% endif %}>Híbrido</option>
                                 </select>
                             </div>
                            
                            <div class="form-group full-width">
                                <label for="acessibilidade" class="required">Acessibilidade</label>
                                <select id="acessibilidade" name="acessibilidade" required onchange="toggleRecursosAcessibilidade()">
                                    <option value="">Selecione uma opção</option>
                                    <option value="acessivel" {% if course.acessibilidade == 'acessivel' %}selected{% endif %}>Acessível para pessoas com deficiência</option>
                                    <option value="exclusivo" {% if course.acessibilidade == 'exclusivo' %}selected{% endif %}>Exclusivo para pessoas com deficiência</option>
                                    <option value="nao_acessivel" {% if course.acessibilidade == 'nao_acessivel' %}selected{% endif %}>Não acessível para Pessoas com Deficiência</option>
                                </select>
                            </div>

                            <div class="form-group full-width" id="recursos_acessibilidade_container" style="display: {% if course.acessibilidade == 'acessivel' or course.acessibilidade == 'exclusivo' %}block{% else %}none{% endif %};">
                                <label for="recursos_acessibilidade" class="required">Recursos de Acessibilidade</label>
                                <textarea id="recursos_acessibilidade" name="recursos_acessibilidade" rows="3"
                                          placeholder="Ex: Intérprete de Libras, material em Braille, rampa de acesso, elevador...">{{ course.recursos_acessibilidade }}</textarea>
                            </div>

                            <div class="form-group full-width">
                                <label for="publico_alvo" class="required">Público-alvo</label>
                                <textarea id="publico_alvo" name="publico_alvo" required rows="3"
                                          placeholder="Ex: Servidores públicos, estudantes, profissionais da área de tecnologia...">{{ course.publico_alvo }}</textarea>
                            </div>

                            <div class="form-group full-width">
                                <label class="required">O curso é gratuito?</label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="curso_gratuito" value="sim" required onclick="toggleValorCurso(false)" {% if course.curso_gratuito == 'sim' %}checked{% endif %}> SIM
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="curso_gratuito" value="nao" required onclick="toggleValorCurso(true)" {% if course.curso_gratuito == 'nao' %}checked{% endif %}> NÃO
                                    </label>
                                </div>
                            </div>

                            <div class="form-group full-width" id="valor_curso_container" style="display: {% if course.curso_gratuito == 'nao' %}block{% else %}none{% endif %};">
                                <div class="valor-curso-row">
                                    <div class="valor-curso-col">
                                        <label for="valor_curso_inteira" class="required">Valor INTEIRA (R$)</label>
                                        <input type="text" id="valor_curso_inteira" name="valor_curso_inteira" step="0.01" min="0"
                                            placeholder="Digite o valor integral (ex: 100,00)" oninput="formatarValor(this)" value="{{ course.valor_curso_inteira }}">
                                    </div>
                                    <div class="valor-curso-col">
                                        <label for="valor_curso_meia">Valor MEIA (R$)</label>
                                        <input type="text" id="valor_curso_meia" name="valor_curso_meia" step="0.01" min="0"
                                            placeholder="Digite o valor da meia (ex: 50,00)" oninput="formatarValor(this); toggleRequisitos()" value="{{ course.valor_curso_meia }}">
                                    </div>
                                </div>
                                <div id="requisitos_meia_container" style="display: {% if course.valor_curso_meia %}block{% else %}none{% endif %};">
                                    <label for="requisitos_meia" class="required">Condições para obtenção de meia-entrada</label>
                                    <textarea id="requisitos_meia" name="requisitos_meia" rows="2" required
                                        placeholder="Ex: Estudantes, idosos, pessoas com deficiência...">{{ course.requisitos_meia }}</textarea>
                                </div>
                             </div>

                            <div class="form-group full-width">
                                <label class="required">Oferece Certificado</label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="oferece_certificado" value="sim" required onclick="togglePreRequisitos(true)" {% if course.oferece_certificado == 'sim' %}checked{% endif %}> SIM
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="oferece_certificado" value="nao" required onclick="togglePreRequisitos(false)" {% if course.oferece_certificado == 'nao' %}checked{% endif %}> NÃO
                                    </label>
                                </div>
                            </div>

                            <div class="form-group full-width" id="pre_requisitos_container" style="display: {% if course.oferece_certificado == 'sim' %}block{% else %}none{% endif %};">
                                <label for="pre_requisitos" class="required">Pré-requisitos para Recebimento de Certificados</label>
                                <textarea id="pre_requisitos" name="pre_requisitos" rows="3"
                                          placeholder="Ex: Frequência mínima de 75%, entrega de trabalho final, aprovação em avaliação...">{{ course.pre_requisitos }}</textarea>
                            </div>

                            <div class="form-group full-width">
                                <label class="required">Oferece Bolsa</label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="oferece_bolsa" value="sim" required onclick="toggleValorBolsa(true)" {% if course.oferece_bolsa == 'sim' %}checked{% endif %}> SIM
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="oferece_bolsa" value="nao" required onclick="toggleValorBolsa(false)" {% if course.oferece_bolsa == 'nao' %}checked{% endif %}> NÃO
                                    </label>
                                </div>
                            </div>

                            <div class="form-group full-width" id="valor_bolsa_container" style="display: {% if course.oferece_bolsa == 'sim' %}block{% else %}none{% endif %};">
                                <label for="valor_bolsa" class="required">Valor da Bolsa (R$)</label>
                                <input type="text" id="valor_bolsa" name="valor_bolsa" step="0.01" min="0"
                                       placeholder="Digite o valor da bolsa (ex: 100,00)" oninput="formatarValor(this)" value="{{ course.valor_bolsa }}">
                            </div>
                            
                            <div class="form-group full-width" id="requisitos_bolsa_container" style="display: {% if course.oferece_bolsa == 'sim' %}block{% else %}none{% endif %};">
                                <label for="requisitos_bolsa" class="required">Requisitos para a Obtenção da Bolsa</label>
                                <textarea id="requisitos_bolsa" name="requisitos_bolsa" rows="3"
                                          placeholder="Descreva os requisitos necessários para obtenção da bolsa">{{ course.requisitos_bolsa }}</textarea>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="info_complementares">Informações Complementares para inscrição de participantes</label>
                                <span style="color:red; font-size:0.9em; display:block; margin:4px 0 8px;">OBS: Com o acesso via gov.br, já teremos o Nome e CPF do candidato.</span>
                                <textarea id="info_complementares" name="info_complementares" rows="4"
                                          placeholder="Informe quais dados serão necessários para inscrição dos participantes (Ex: Escolaridade, Idade, Bairro, etc.)">{{ course.info_complementares }}</textarea>                        
                            </div>

                            <!-- Pergunta: Informações adicionais do curso? -->
                            <div class="form-group full-width">
                                <label class="required">Informações adicionais do curso?</label>
                                <span style="color:red; font-size: 0.9em; display:block; margin:4px 0 8px;">Para divulgar o curso de forma clara e objetiva, o foco deve ser em apresentar somente as informações mais importantes. Detalhes adicionais podem ser comunicados aos alunos que se matricularem, por isso, avalie se esses dados são realmente essenciais para o público geral no momento da divulgação.</span>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="info_adicionais_opcao" value="sim" required onclick="toggleInfoAdicionais(true)" {% if course.info_adicionais_opcao == 'sim' %}checked{% endif %}> SIM
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="info_adicionais_opcao" value="nao" required onclick="toggleInfoAdicionais(false)" {% if course.info_adicionais_opcao == 'nao' %}checked{% endif %}> NÃO
                                    </label>
                                </div>
                            </div>

                            <div class="form-group full-width" id="info_adicionais_container" style="display: {% if course.info_adicionais_opcao == 'sim' %}block{% else %}none{% endif %};">
                                <label for="info_adicionais" class="required">Informações Adicionais do Curso</label>
                                <textarea id="info_adicionais" name="info_complementares" rows="4" placeholder="Digite informações adicionais, como recursos utilizados, facilitador, etc">{{ course.info_complementares }}</textarea>
                            </div>
                            
                            <!-- Parceiro Externo -->
                            <div class="form-group full-width">
                                <label class="required">CURSO OFERECIDO POR PARCEIRO EXTERNO?</label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="parceiro_externo" value="sim" required onclick="toggleParceiroExterno(true)" {% if course.parceiro_externo == 'sim' %}checked{% endif %}> SIM
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="parceiro_externo" value="nao" required onclick="toggleParceiroExterno(false)" {% if course.parceiro_externo == 'nao' %}checked{% endif %}> NÃO
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-group full-width" id="parceiro_externo_container" style="display: {% if course.parceiro_externo == 'sim' %}block{% else %}none{% endif %};">
                                <fieldset class="unidade-fieldset">
                                    <legend>Informações do Parceiro</legend>
                                    
                                    <div class="parceiro-grid">
                                        <div class="parceiro-item">
                                            <label for="parceiro_nome" class="required">Nome do Parceiro</label>
                                            <input type="text" id="parceiro_nome" name="parceiro_nome" placeholder="Ex: Fundação Exemplo" value="{{ course.parceiro_nome }}">
                                        </div>
                                        
                                        <div class="parceiro-item">
                                            <label for="parceiro_logo">Logo do Parceiro</label>
                                            <input type="file" id="parceiro_logo" name="parceiro_logo" accept=".png,.jpg,.jpeg,image/*">
                                            <small class="file-hint">Formatos aceitos: PNG, JPG, JPEG</small>
                                        </div>
                                        
                                        <div class="parceiro-item full-width">
                                            <label for="parceiro_link">Link do Parceiro</label>
                                            <input type="text" id="parceiro_link" name="parceiro_link" placeholder="https://exemplo.org" value="{{ course.parceiro_link }}">
                                            <small class="help-text-red">Link da página web para onde o usuário será redirecionado para fins de inscrição na plataforma do parceiro</small>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <a href="{{ url_for('list_courses') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Voltar
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Salvar Alterações
                        </button>
                    </div>
                </form>
            </div>
        </main>
    <script>
        function toggleValorCurso(mostrar) {
            const valorCursoContainer = document.getElementById('valor_curso_container');
            if (valorCursoContainer) {
                valorCursoContainer.style.display = mostrar ? 'block' : 'none';
            }
        }

        function togglePreRequisitos(mostrar) {
            const preRequisitosContainer = document.getElementById('pre_requisitos_container');
            if (preRequisitosContainer) {
                preRequisitosContainer.style.display = mostrar ? 'block' : 'none';
            }
        }

        function toggleRecursosAcessibilidade() {
            const acessibilidadeSelect = document.getElementById('acessibilidade');
            const recursosContainer = document.getElementById('recursos_acessibilidade_container');
            if (acessibilidadeSelect && recursosContainer) {
                recursosContainer.style.display = (acessibilidadeSelect.value === 'acessivel' || acessibilidadeSelect.value === 'exclusivo') ? 'block' : 'none';
            }
        }

        function toggleValorBolsa(mostrar) {
            const valorBolsaContainer = document.getElementById('valor_bolsa_container');
            const requisitosContainer = document.getElementById('requisitos_bolsa_container');
            if (valorBolsaContainer) valorBolsaContainer.style.display = mostrar ? 'block' : 'none';
            if (requisitosContainer) requisitosContainer.style.display = mostrar ? 'block' : 'none';
        }

        function toggleParceiroExterno(mostrar) {
            const container = document.getElementById('parceiro_externo_container');
            if (container) {
                container.style.display = mostrar ? 'block' : 'none';
            }
        }

        function toggleInfoAdicionais(mostrar) {
            const container = document.getElementById('info_adicionais_container');
            if (container) {
                container.style.display = mostrar ? 'block' : 'none';
            }
        }

        function toggleUnidades() {
            const modalidade = document.getElementById('modalidade').value;
            const unidadesContainer = document.getElementById('unidades_container');
            const plataformaContainer = document.getElementById('plataforma_container');
            
            if (unidadesContainer) unidadesContainer.style.display = 'none';
            if (plataformaContainer) plataformaContainer.style.display = 'none';
            
            if (modalidade === 'Presencial' || modalidade === 'Híbrido') {
                if (unidadesContainer) unidadesContainer.style.display = 'block';
            } else if (modalidade === 'Online') {
                if (plataformaContainer) plataformaContainer.style.display = 'block';
            }
        }

        function toggleAulasAssincronas(isAssincronas) {
            const horariosContainer = document.getElementById('horarios_detalhados_online_container');
            const horariosOnlineContainer = document.getElementById('horarios_online_container');
            
            if (horariosContainer && horariosOnlineContainer) {
                horariosContainer.style.display = isAssincronas ? 'none' : 'block';
                horariosOnlineContainer.style.display = isAssincronas ? 'none' : 'block';
            }
        }

        function formatarValor(input) {
            let valor = input.value.replace(/[^\d,]/g, '');
            const partes = valor.split(',');
            if (partes.length > 2) {
                valor = partes[0] + ',' + partes.slice(1).join('');
            }
            if (partes.length === 2 && partes[1].length > 2) {
                valor = partes[0] + ',' + partes[1].substring(0, 2);
            }
            input.value = valor;
        }

        function toggleRequisitos() {
            const valorMeia = document.getElementById('valor_curso_meia');
            const requisitosContainer = document.getElementById('requisitos_meia_container');
            const requisitosField = document.getElementById('requisitos_meia');
            
            if (valorMeia && requisitosContainer && requisitosField) {
                const valor = valorMeia.value.trim();
                
                if (valor !== '') {
                    // Se há valor na meia, mostrar campo de requisitos
                    requisitosContainer.style.display = 'block';
                    requisitosField.setAttribute('required', 'required');
                } else {
                    // Se não há valor na meia, esconder campo de requisitos
                    requisitosContainer.style.display = 'none';
                    requisitosField.removeAttribute('required');
                    requisitosField.value = '';
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Não chamar toggleUnidades automaticamente para evitar resetar campos
            // toggleUnidades();
            
            // Apenas inicializar campos condicionais se necessário
            const modalidade = document.getElementById('modalidade');
            if (modalidade && modalidade.value) {
                // Mostrar containers apropriados baseado na modalidade atual
                const unidadesContainer = document.getElementById('unidades_container');
                const plataformaContainer = document.getElementById('plataforma_container');
                
                if (modalidade.value === 'Presencial' || modalidade.value === 'Híbrido') {
                    if (unidadesContainer) unidadesContainer.style.display = 'block';
                    if (plataformaContainer) plataformaContainer.style.display = 'none';
                } else if (modalidade.value === 'Online') {
                    if (unidadesContainer) unidadesContainer.style.display = 'none';
                    if (plataformaContainer) plataformaContainer.style.display = 'block';
                }
            }
        });
    </script>
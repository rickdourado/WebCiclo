<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Curso - Ciclo Carioca</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Função para formatar datas no formato brasileiro
            function formatarDataBrasileira() {
                const camposData = document.querySelectorAll('input[type="date"]');
                camposData.forEach(campo => {
                    campo.addEventListener('change', function() {
                        if (this.value) {
                            const [ano, mes, dia] = this.value.split('-');
                            const dataFormatada = `${dia}/${mes}/${ano}`;
                            // Exibe a data formatada em um elemento adjacente ou tooltip
                            this.setAttribute('title', `Data: ${dataFormatada}`);
                        }
                    });
                    // Formatar datas já preenchidas
                    if (campo.value) {
                        const [ano, mes, dia] = campo.value.split('-');
                        const dataFormatada = `${dia}/${mes}/${ano}`;
                        campo.setAttribute('title', `Data: ${dataFormatada}`);
                    }
                });
            }
            
            // Mostrar/ocultar campo de pré-requisitos com base na seleção de certificado
            const certificadoSelect = document.getElementById('oferece_certificado');
            const preRequisitosGroup = document.getElementById('pre_requisitos_group');
            
            if (certificadoSelect && preRequisitosGroup) {
                function togglePreRequisitos() {
                    if (certificadoSelect.value === 'sim') {
                        preRequisitosGroup.style.display = 'block';
                    } else {
                        preRequisitosGroup.style.display = 'none';
                    }
                }
                
                certificadoSelect.addEventListener('change', togglePreRequisitos);
                togglePreRequisitos(); // Executar na carga inicial
            }
            
            formatarDataBrasileira();
        });
    </script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo-section">
                    <a href="{{ url_for('index') }}" title="Ir para página inicial">
                        <img src="{{ url_for('static', filename='images/logo_ciclocarioca..png') }}" alt="Logo Ciclo Carioca">
                    </a>
                    <span class="version">v2.0</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="form-container">
                <div class="form-header">
                    <h2><i class="fas fa-edit"></i> Editar Curso</h2>
                    <p class="form-description">Atualize as informações do curso #{{ course.id }} - {{ course.titulo }}</p>
                </div>

                <!-- Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }}">
                                <i class="fas fa-{{ 'check-circle' if category == 'success' else 'exclamation-triangle' }}"></i>
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <form method="POST" action="{{ url_for('edit_course', course_id=course.id) }}" class="course-form" enctype="multipart/form-data">
                    <!-- Formulário de Edição de Curso -->
                    <div class="form-section">
                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label for="titulo" class="required">Nome do Curso</label>
                                <input type="text" id="titulo" name="titulo" required 
                                       placeholder="Digite o título do curso" value="{{ course.titulo }}">
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="descricao" class="required">Descrição</label>
                                <textarea id="descricao" name="descricao" rows="6" required
                                          placeholder="Digite a descrição do curso">{{ course.descricao }}</textarea>
                            </div>
                            
                            <div class="form-group full-width">
                                <label for="capa_curso">Capa do Curso</label>
                                <div class="file-upload-container">
                                    <input type="file" id="capa_curso" name="capa_curso" accept=".jpeg,.png,.jpg,.bmp,image/jpeg,image/png,image/jpg,image/bmp">
                                    <div class="file-upload-display">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <span class="file-upload-text">Clique para selecionar uma imagem</span>
                                        <span class="file-upload-hint">Formatos aceitos: JPEG, PNG, JPG, BMP</span>
                                    </div>
                                </div>
                                <small class="file-hint">A imagem será renomeada para o nome do curso e armazenada na pasta IMAGENSCURSOS</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="inicio_inscricoes" class="required">Início das inscrições</label>
                                <div class="datetime-group">
                                    <input type="date" id="inicio_inscricoes_data" name="inicio_inscricoes_data" value="{{ course.inicio_inscricoes_data }}" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="fim_inscricoes" class="required">Fim das inscrições</label>
                                <div class="datetime-group">
                                    <input type="date" id="fim_inscricoes_data" name="fim_inscricoes_data" value="{{ course.fim_inscricoes_data }}" required>
                                </div>
                            </div>
                            
                            <div class="form-group full-width">
                                 <label for="orgao" class="required">Órgão (Quem oferece o curso)</label>
                                 <select id="orgao" name="orgao" required>
                                     <option value="">Selecione um órgão</option>
                                     {% for orgao in orgaos %}
                                         <option value="{{ orgao }}" {% if course.orgao == orgao %}selected{% endif %}>{{ orgao }}</option>
                                     {% endfor %}
                                 </select>
                             </div>

                             
                             <div class="form-group full-width">
                                 <label for="tema" class="required">Categoria</label>
                                 <select id="tema" name="tema" required>
                                     <option value="">Selecione a categoria</option>
                                     <option value="Tech" {% if course.tema == 'Tech' %}selected{% endif %}>Tech</option>
                                     <option value="Dados" {% if course.tema == 'Dados' %}selected{% endif %}>Dados</option>
                                     <option value="IA" {% if course.tema == 'IA' %}selected{% endif %}>IA</option>
                                     <option value="Design" {% if course.tema == 'Design' %}selected{% endif %}>Design</option>
                                     <option value="Cibersegurança" {% if course.tema == 'Cibersegurança' %}selected{% endif %}>Cibersegurança</option>
                                     <option value="Marketing" {% if course.tema == 'Marketing' %}selected{% endif %}>Marketing</option>
                                     <option value="Finanças" {% if course.tema == 'Finanças' %}selected{% endif %}>Finanças</option>
                                     <option value="Gestão" {% if course.tema == 'Gestão' %}selected{% endif %}>Gestão</option>
                                     <option value="Games" {% if course.tema == 'Games' %}selected{% endif %}>Games</option>
                                     <option value="Nutrição" {% if course.tema == 'Nutrição' %}selected{% endif %}>Nutrição</option>
                                     <option value="Educação" {% if course.tema == 'Educação' %}selected{% endif %}>Educação</option>
                                     <option value="Gastronomia" {% if course.tema == 'Gastronomia' %}selected{% endif %}>Gastronomia</option>
                                     <option value="Saúde" {% if course.tema == 'Saúde' %}selected{% endif %}>Saúde</option>
                                     <option value="Veterinária" {% if course.tema == 'Veterinária' %}selected{% endif %}>Veterinária</option>
                                     <option value="Carreira" {% if course.tema == 'Carreira' %}selected{% endif %}>Carreira</option>
                                     <option value="Estética" {% if course.tema == 'Estética' %}selected{% endif %}>Estética</option>
                                     <option value="Sustentabilidade" {% if course.tema == 'Sustentabilidade' %}selected{% endif %}>Sustentabilidade</option>
                                     <option value="Artes" {% if course.tema == 'Artes' %}selected{% endif %}>Artes</option>
                                     <option value="Cultura" {% if course.tema == 'Cultura' %}selected{% endif %}>Cultura</option>
                                     <option value="Astronomia" {% if course.tema == 'Astronomia' %}selected{% endif %}>Astronomia</option>
                                 </select>
                             </div>
                            
                             <div class="form-group full-width">
                                 <label for="modalidade" class="required">Modalidade</label>
                                 <select id="modalidade" name="modalidade" required onchange="toggleUnidades();">
                                     <option value="">Selecione a modalidade</option>
                                     <option value="Presencial" {% if course.modalidade == 'Presencial' %}selected{% endif %}>Presencial</option>
                                     <option value="Online" {% if course.modalidade == 'Online' %}selected{% endif %}>Online</option>
                                     <option value="Híbrido" {% if course.modalidade == 'Híbrido' %}selected{% endif %}>Híbrido</option>
                                 </select>
                             </div>
                            
                            <div class="form-group full-width">
                                <label for="publico_alvo" class="required">Público-alvo</label>
                                <textarea id="publico_alvo" name="publico_alvo" required rows="3"
                                          placeholder="Ex: Servidores públicos, estudantes, profissionais da área de tecnologia...">{{ course.publico_alvo }}</textarea>
                            </div>

                            <div class="form-group full-width">
                                <label class="required">O curso é gratuito?</label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="curso_gratuito" value="sim" required onclick="toggleValorCurso(false)"> SIM
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="curso_gratuito" value="nao" required onclick="toggleValorCurso(true)"> NÃO
                                    </label>
                                </div>
                            </div>

                            <div class="form-group full-width">
                                <label class="required">Oferece Certificado</label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="oferece_certificado" value="sim" required onclick="togglePreRequisitos(true)"> SIM
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="oferece_certificado" value="nao" required onclick="togglePreRequisitos(false)"> NÃO
                                    </label>
                                </div>
                            </div>

                            <div class="form-group full-width" id="pre_requisitos_container" style="display: none;">
                                <label for="pre_requisitos" class="required">Pré-requisitos para Recebimento de Certificados</label>
                                <textarea id="pre_requisitos" name="pre_requisitos" rows="3"
                                          placeholder="Ex: Frequência mínima de 75%, entrega de trabalho final, aprovação em avaliação...">{{ course.pre_requisitos }}</textarea>
                            </div>

                            <div class="form-group full-width">
                                <label for="info_complementares">Informações Complementares para inscrição de participantes</label>
                                <span style="color:red; font-size:0.9em; display:block; margin:4px 0 8px;">OBS: Com o acesso via gov.br, já teremos o Nome e CPF do candidato.</span>
                                <textarea id="info_complementares" name="info_complementares" rows="4"
                                          placeholder="Informe quais dados serão necessários para inscrição dos participantes (Ex: Escolaridade, Idade, Bairro, etc.)">{{ course.info_complementares }}</textarea>                        
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <a href="{{ url_for('list_courses') }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Voltar
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Salvar Alterações
                        </button>
                    </div>
                </form>
            </div>
        </main>
    <script>
        function toggleValorCurso(mostrar) {
            const valorCursoContainer = document.getElementById('valor_curso_container');
            if (valorCursoContainer) {
                valorCursoContainer.style.display = mostrar ? 'block' : 'none';
            }
        }

        function togglePreRequisitos(mostrar) {
            const preRequisitosContainer = document.getElementById('pre_requisitos_container');
            if (preRequisitosContainer) {
                preRequisitosContainer.style.display = mostrar ? 'block' : 'none';
            }
        }

        function toggleRecursosAcessibilidade() {
            const acessibilidadeSelect = document.getElementById('acessibilidade');
            const recursosContainer = document.getElementById('recursos_acessibilidade_container');
            if (acessibilidadeSelect && recursosContainer) {
                recursosContainer.style.display = (acessibilidadeSelect.value === 'acessivel' || acessibilidadeSelect.value === 'exclusivo') ? 'block' : 'none';
            }
        }

        function toggleValorBolsa(mostrar) {
            const valorBolsaContainer = document.getElementById('valor_bolsa_container');
            const requisitosContainer = document.getElementById('requisitos_bolsa_container');
            if (valorBolsaContainer) valorBolsaContainer.style.display = mostrar ? 'block' : 'none';
            if (requisitosContainer) requisitosContainer.style.display = mostrar ? 'block' : 'none';
        }

        function toggleParceiroExterno(mostrar) {
            const container = document.getElementById('parceiro_externo_container');
            if (container) {
                container.style.display = mostrar ? 'block' : 'none';
            }
        }

        function toggleInfoAdicionais(mostrar) {
            const container = document.getElementById('info_adicionais_container');
            if (container) {
                container.style.display = mostrar ? 'block' : 'none';
            }
        }

        function toggleUnidades() {
            const modalidade = document.getElementById('modalidade').value;
            const unidadesContainer = document.getElementById('unidades_container');
            const plataformaContainer = document.getElementById('plataforma_container');
            
            if (unidadesContainer) unidadesContainer.style.display = 'none';
            if (plataformaContainer) plataformaContainer.style.display = 'none';
            
            if (modalidade === 'Presencial' || modalidade === 'Híbrido') {
                if (unidadesContainer) unidadesContainer.style.display = 'block';
            } else if (modalidade === 'Online') {
                if (plataformaContainer) plataformaContainer.style.display = 'block';
            }
        }

        function toggleAulasAssincronas(isAssincronas) {
            const horariosContainer = document.getElementById('horarios_detalhados_online_container');
            const horariosOnlineContainer = document.getElementById('horarios_online_container');
            
            if (horariosContainer && horariosOnlineContainer) {
                horariosContainer.style.display = isAssincronas ? 'none' : 'block';
                horariosOnlineContainer.style.display = isAssincronas ? 'none' : 'block';
            }
        }

        function formatarValor(input) {
            let valor = input.value.replace(/[^\d,]/g, '');
            const partes = valor.split(',');
            if (partes.length > 2) {
                valor = partes[0] + ',' + partes.slice(1).join('');
            }
            if (partes.length === 2 && partes[1].length > 2) {
                valor = partes[0] + ',' + partes[1].substring(0, 2);
            }
            input.value = valor;
        }

        document.addEventListener('DOMContentLoaded', function() {
            toggleUnidades();
        });
    </script>
# Changelog - 17/01/2025

## ğŸ”§ Melhorias e Ferramentas

### Script de Teste de ConexÃ£o com Banco de Dados
- âœ… Criado script `scripts/test_db_connection.py` para verificar conectividade com MySQL
- âœ… Script exibe informaÃ§Ãµes detalhadas:
  - ConfiguraÃ§Ãµes do banco (host, porta, usuÃ¡rio, banco)
  - VersÃ£o do MySQL
  - Lista de todas as tabelas
  - NÃºmero de registros por tabela
  - Estrutura completa de cada tabela (colunas, tipos, constraints)
- âœ… Adicionada dependÃªncia `pymysql==1.1.0` ao `requirements.txt`
- âœ… Tratamento de erros com mensagens claras e sugestÃµes de soluÃ§Ã£o

### Resultado do Teste
- âœ… ConexÃ£o com banco `cursoscarioca` estabelecida com sucesso
- âœ… MySQL versÃ£o 8.0.44 detectado
- âœ… 5 tabelas encontradas: cursos, plataformas_online, turmas, turmas_dias_semana, users
- â„¹ï¸ Banco estÃ¡ vazio (0 registros)

## ğŸ“Š Estrutura das Tabelas

### Tabela `cursos` (33 campos)
- InformaÃ§Ãµes bÃ¡sicas (tipo_aÃ§Ã£o, tÃ­tulo, descriÃ§Ã£o)
- Datas (inÃ­cio/fim inscriÃ§Ãµes)
- Modalidade (Presencial, Online, HÃ­brido)
- Acessibilidade e recursos
- Valores e bolsas
- Parceiros externos
- Status e timestamps
- Campos de auditoria (created_at, updated_at, created_by)

### Tabela `users` (7 campos)
- id, email, senha, ativo
- ultimo_acesso, created_at, updated_at

### Tabelas de Relacionamento
- `turmas` (17 campos) - Para cursos presenciais/hÃ­bridos
- `turmas_dias_semana` (3 campos) - Dias da semana das turmas
- `plataformas_online` (14 campos) - Para cursos online/hÃ­bridos

## ğŸ” MigraÃ§Ã£o de AutenticaÃ§Ã£o para Banco de Dados

### Arquivos Criados
- âœ… `repositories/user_repository.py` - RepositÃ³rio para operaÃ§Ãµes com usuÃ¡rios
- âœ… `scripts/create_admin_user.py` - Script para criar usuÃ¡rio administrador
- âœ… `scripts/test_auth.py` - Script para testar autenticaÃ§Ã£o

### AlteraÃ§Ãµes no Sistema
- âœ… `services/auth_service.py` - Migrado para usar banco de dados
  - MÃ©todo `authenticate_admin()` agora busca usuÃ¡rios na tabela `users`
  - Retorna dados do usuÃ¡rio autenticado (id, email, ultimo_acesso)
  - Atualiza campo `ultimo_acesso` a cada login
  - Novo mÃ©todo `create_user()` para criar usuÃ¡rios
  
- âœ… `app.py` - Atualizado para nova autenticaÃ§Ã£o
  - Rota `/admin/login` agora usa email ao invÃ©s de username
  - Session armazena `user_id` e `user_email` ao invÃ©s de `admin_username`
  - Logout limpa todos os dados da sessÃ£o
  
- âœ… `forms.py` - FormulÃ¡rio de login atualizado
  - Campo `username` renomeado para `Email`
  - ValidaÃ§Ã£o de email adicionada
  - Placeholder atualizado

### Funcionalidades Implementadas
- âœ… AutenticaÃ§Ã£o via banco de dados MySQL
- âœ… Busca de usuÃ¡rio por email
- âœ… VerificaÃ§Ã£o de senha com bcrypt
- âœ… AtualizaÃ§Ã£o automÃ¡tica de Ãºltimo acesso
- âœ… ValidaÃ§Ã£o de usuÃ¡rio ativo
- âœ… CriaÃ§Ã£o de novos usuÃ¡rios com hash de senha

### UsuÃ¡rios Criados
1. **Admin Principal**
   - âœ… Email: admin@cicloscarioca.rio
   - âœ… Senha: admin123 (hash bcrypt armazenado)
   - âœ… Status: Ativo
   - âœ… ID: 1

2. **Oportunidades Cariocas**
   - âœ… Email: oportunidades.cariocas@prefeitura.rio
   - âœ… Senha: GPCE#2025# (hash bcrypt armazenado)
   - âœ… Status: Ativo
   - âœ… ID: 2

### Scripts UtilitÃ¡rios
1. **create_admin_user.py**
   - Cria usuÃ¡rio administrador no banco
   - Solicita email e senha
   - Gera hash bcrypt automaticamente
   
2. **test_auth.py**
   - Testa autenticaÃ§Ã£o de usuÃ¡rios
   - Lista usuÃ¡rios cadastrados
   - Mostra Ãºltimo acesso e status

### PrÃ³ximos Passos
- â³ Migrar criaÃ§Ã£o de cursos para banco de dados
- â³ Migrar listagem de cursos para banco de dados
- â³ Implementar relacionamentos (cursos â†’ turmas â†’ dias_semana)
- â³ Implementar relacionamentos (cursos â†’ plataformas_online)
- â³ Criar views para consultas otimizadas
